---
date: '2023-05-24'
title: 'Gatsby ë¸”ë¡œê·¸ - ë‹¤í¬ëª¨ë“œ êµ¬í˜„ê¸°ğŸŒ—'
categories: ['Web', 'Gatsby']
summary: 'ì–´ë¦¬ë°”ë¦¬ ì‘ì•  FE ê°œë°œìì˜ ë‹¤í¬ëª¨ë“œ êµ¬í˜„ ì‚½ì§ˆê¸° - ì–´ë””ì„œë¶€í„° ì–´ë–»ê²Œ í•´ì•¼ë ì§€ ê°ì„ ëª»ì¡ê² ë‹¤ë©´ğŸ¥´'
thumbnail: '../images/gatsby.jpg'
---

ìš°ì„  ê¸€ì„ ì‹œì‘í•˜ê¸° ì „ì—.. 5ì›” 24ì¼ ë¶€ë¡œ ë¸”ë¡œê·¸ ê°œë°œì„ ì‹œì‘í•œì§€ 1ë‹¬ ë„˜ì€ ì‹œì ì—ì„œ 100ê°œì˜ commitì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤..ğŸ¥³

<div style="text-align:center"><img src="https://velog.velcdn.com/images/damin1025/post/0e0117f4-e670-4a3c-a849-c5eadf34c786/image.PNG" /></div>


ì €ì—ê²Œ ì´ `ê°œë°œ ë¸”ë¡œê·¸` í”„ë¡œì íŠ¸ëŠ” **í”„ë¡ íŠ¸ì—”ë“œê°€ ë­”ì§€ ì œëŒ€ë¡œ ë³´ì—¬ì¤€** í”„ë¡œì íŠ¸ë‚˜ ë‹¤ë¦„ ì—†ì–´ì„œ ë°°ìš´ê²Œ ì •ë§ ë§ì€ ê³ ë§ˆìš´ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤. ë§Œì•½ í”„ë¡ íŠ¸ì—”ë“œë¥¼ ë‚´ ì»¤ë¦¬ì–´íŒ¨ìŠ¤ë¡œ ë°Ÿê³  ì‹¶ë‹¤ê³  í•œë‹¤ë©´ ìì‹ ë§Œì˜ ë¸”ë¡œê·¸ ë§Œë“œëŠ” ê²ƒì„ ì ê·¹ ì¶”ì²œí•  ì •ë„ë¡œ ë°°ìš¸ê²Œ ì •ë§ ë§ê³  ì¢‹ì€ í”„ë¡œì íŠ¸ë¼ê³  ìƒê°í•©ë‹ˆë‹¤. 

ì‚¬ì¡±ì€ ì—¬ê¸°ì„œ ë§ˆë¬´ë¦¬ ì§“ê³ .. ë‹¤í¬ëª¨ë“œë¥¼ êµ¬í˜„í•˜ë©´ì„œ ê²ªì€ ì œ ì‚½ì§ˆê¸°ë¥¼ ë‚˜ì—´í•´ë³´ê² ìŠµë‹ˆë‹¤ ğŸ¤ª...


## ë™ê¸° 
ì´ í”„ë¡œì íŠ¸ë¥¼ ì²˜ìŒ êµ¬ìƒí•˜ê³  ê·¸ë¦¬ê³  ê¸°ëŠ¥ë“¤ì„ í•˜ë‚˜ì”© ë§Œë“¤ì–´ ë‚˜ê°ˆë•Œ ì„¸ìš´ ëª©í‘œ ì¤‘ í•˜ë‚˜ê°€ ë‹¤í¬ëª¨ë“œëŠ” ê¼­ ë§Œë“¤ì–´ì•¼ì§€..! ìƒê°í–ˆìŠµë‹ˆë‹¤. íŠ¹íˆ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì´ì œ ì—†ìœ¼ë©´ í—ˆì „í•  ì •ë„ë¼ê³  ë³¼ ìˆ˜ ìˆëŠ” **ë‹¤í¬ëª¨ë“œğŸŒ—** ê¸°ëŠ¥ì„ Gatsbyì™€ ì–´ëŠì •ë„ ì¹œí•´ì§€ë©´ ì œëŒ€ë¡œ íŒŒì•¼ê² ë‹¤ ìƒê°í–ˆê³  ë•Œê°€ ì˜¨ ê²ƒì´ì—ˆìŠµë‹ˆë‹¤. 

ì¼ì „ì— Reactë¥¼ ë°°ìš°ê¸° ìœ„í•´ì„œ [Emotionary](https://github.com/dobyming/Emotionary) í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰ ì¤‘, `Provider` ê°œë…ì„ í™œìš©í•˜ì—¬ ìµœìƒìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ `theme` propsë¥¼ ì „ë‹¬í•˜ì—¬ ë‹¤í¬ëª¨ë“œë¥¼ êµ¬í˜„í–ˆë˜ ê²½í—˜ì´ ìˆì—ˆê³ , Gatsbyì—ì„œë„ ì´ëŸ° ê°œë…ì„ í™œìš©í•˜ë©´ ë˜ë ¤ë‚˜? ìƒê°ìœ¼ë¡œë¶€í„° ì‹œì‘í•˜ë©° êµ¬í˜„ì— Dive í–ˆìŠµë‹ˆë‹¤. 

## Themeì„ ì–´ë–»ê²Œ ì „ë‹¬í•  ê²ƒì¸ê°€ : ThemeProvider VS CSS Variable
ëŒ€ëµì ì¸ Mock Upì€ ì´ë ‡ê²Œ êµ¬ìƒí–ˆì—ˆìŠµë‹ˆë‹¤.
>í† ê¸€ ë²„íŠ¼ì´ ìˆìŒ(component) -> í´ë¦­ ê°’(state)ì— ë”°ë¼ ì–´ë–¤ themeì„ ë³´ì—¬ì¤„ì§€ ê²°ì •í•  ê²ƒ. (boolean ì†ì„±ìœ¼ë¡œ trueë©´ dark, falseë©´ light) 

ê·¸ë¦¬ê³  ì´ë•Œ `theme`ì„ ì–´ë–»ê²Œ ì „ë‹¬í•  ê²ƒì¸ê°€? ì´ê²Œ ê´€ê±´ì´ì—ˆìŠµë‹ˆë‹¤.  

### ğŸ¤” emotionì˜ ThemeProviderë¡œ ì‚½ì§ˆ 
~~ì˜¤ë˜ì „ì— ìˆ˜í–‰í•œ ì‚½ì§ˆì´ë¼ ê¸°ì–µì´ ì•½ê°„ ê°€ë¬¼í•˜ë„¤ìš”...ã… ~~

ê¸°ì¡´ì— `Provider`ë¥¼ í™œìš©í•˜ì—¬ êµ¬í˜„í•´ ë³¸ ê²½í—˜ì´ ìˆì—ˆê¸° ë•Œë¬¸ì— ë§ˆì¹¨ `emotion`ì—ì„œ `ThemeProvider` Theme packageë¥¼ ì§€ì›í•˜ê³  ìˆì—ˆê³  ì € ì—­ì‹œ ì´ê±¸ë¡œ êµ¬í˜„í•´ì•¼ê² ë‹¤ ìƒê°í•˜ë©° ì½”ë“œ êµ¬í˜„ì— ì§„í–‰í–ˆì§€ë§Œ, ... buildëŠ” ì»¤ë…• develop ë‹¨ê³„ì—ì„œë¶€í„° errorë¥¼ ë§Œë‚˜ê²Œ ë˜ì–´ ë¨¸ë¦¬ë¥¼ ì‹¸ë§¸ìŠµë‹ˆë‹¤.

### ğŸ¥° CSS Variableë¡œ ê´‘ëª…ì„ ì°¾ë‹¤ 
'í† ê¸€ ë²„íŠ¼ì˜ í´ë¦­ ê°’ì— ë”°ë¼ ì–´ë–¤ themeì„ ë³´ì—¬ì¤„ ì§€..' ì´ ë¬¸ì¥ì—ì„œ CSS Variableê³¼ ì—®ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

```tsx
// trigger theme change refer localStorage's key-value
 useLayoutEffect(() => {
	if (userTheme === 'dark') {
    document.body.classList.remove('light')
    document.body.classList.add('dark')
    setIsDark(true)
	} else {
    document.body.classList.remove('dark')
    document.body.classList.add('light')
    setIsDark(false)
    }
 }, [userTheme])
```
ì—¬ê¸°ì„œ `userTheme`ì´ í˜„ì¬ stateì´ê³ , ê·¸ stateê°€ `dark`ë¼ë©´ `body` íƒœê·¸ì˜ classNameì„ `dark`ë¼ê³  ì§€ì •í•˜ê³ , ê·¸ ë°˜ëŒ€ë©´ `light`ë¡œ ì§€ì •í•©ë‹ˆë‹¤. 

ê·¸ëŸ¬ë©´ ì´ `body` íƒœê·¸ì˜ classNameì— ë”°ë¼ì„œ CSS Variableë¡œ ì§€ì •í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.   
```css
/*theme.css*/

.light {
    --color-background:#f6f6f6;
}

.dark {
    --color-background: #25262c;
    --color-text: #f6f6f6;
}

body {
    background-color: var(--color-background);
    transition: 0.2s;
}

h1,
h2,
h3,
h4,
h5,
hr,
a,
p,
li,
td,
tr,
footer,
span {
  color: var(--color-text);
}
```
`theme.css` íŒŒì¼ì— ìœ„ì™€ ê°™ì´ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒë‹¨ì—ëŠ” bodyì˜ classNameì— ë”°ë¼ì„œ ì–´ë–¤ css ì†ì„± ê°’ì„ ë¶€ì—¬í•  ì§€ rgb ê°’ì„ ì •ì˜í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  **ì›í•˜ëŠ” íƒœê·¸ì— ì›í•˜ëŠ” CSS Variable**ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ° ë¡œì§ìœ¼ë¡œ ìˆ˜í–‰í•˜ë©´ ì „ì²´ì ìœ¼ë¡œ ê°œë°œ ë¸”ë¡œê·¸ì— ë‹¤í¬ëª¨ë“œê°€ ì ìš©ë¨ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

ê·¸ë¦¬ê³  ì‹¤ì œë¡œ Providerë¥¼ í™œìš©í•´ ë‹¤í¬ëª¨ë“œë¥¼ êµ¬í˜„í•˜ëŠ” ê²ƒë³´ë‹¨, CSS Variableì„ í™œìš©í•˜ì—¬ êµ¬í˜„í•œ ê²ƒì´ **ì„±ëŠ¥ì ì¸** ì¸¡ë©´ì—ì„œë„ ë” ì¢‹ì€ ì§€í‘œë¥¼ ë³´ì—¬ì¤¬ìŠµë‹ˆë‹¤. 
[Dark Mode Theme PR](https://github.com/dobyming/dobyming.github.io/pull/11) í•´ë‹¹ ë§í¬ë¡œ ê°€ì‹œë©´ ì œê°€ ì™œ CSS Variableì„ ì„ íƒí•˜ì—¬ êµ¬í˜„ì— ì§„í–‰í–ˆëŠ”ì§€ ìì„¸í•œ ì§€í‘œì™€ ì„¤ëª…ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

>+) ì¶”ê°€ë¡œ SVG Iconì— ë‹¤í¬ëª¨ë“œë¥¼ ì–´ë–»ê²Œ ì ìš©í•´ì•¼ í•  ì§€ ë§‰ë§‰í•œ ë¶„ë“¤ê»˜ ê°„ëµí•œ ì½”ë“œë¥¼ ë³´ì—¬ë“œë¦¬ê³ ì í•©ë‹ˆë‹¤. (ì‚¬ì‹¤ ë‚´ê°€ ë°”ë³´ì—¬ì„œ í—·ê°ˆë ¤í–ˆìŒ..)

ìš°ì„  SVG ê°™ì€ ê²½ìš°ì—ëŠ” ìƒ‰ìƒì´ ë‹´ê¸¸ ìˆ˜ ìˆë„ë¡ `fill`ê³¼ `stroke` ì†ì„±ì„ ì§€ì • í•´ì•¼í•©ë‹ˆë‹¤. `fill`ì€ ì±„ì›Œì§€ëŠ” ìƒ‰ì´ê³  `stroke`ëŠ” í…Œë‘ë¦¬ìƒ‰ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ `.svg` íŒŒì¼ì—ì„œ **`path` íƒœê·¸ ë‚´ì— fillê³¼ stroke ì†ì„±ì„ current**ë¡œ ì§€ì •í•©ë‹ˆë‹¤.

```svg
// ì˜ˆì‹œ svg
<svg width="30px" height="30px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path fill="current" stroke="current" fill-rule="evenodd" clip-rule="evenodd" d="M15.7071 4.29289C16.0976 4.68342 16.0976 5.31658 15.7071 5.70711L9.41421 12L15.7071 18.2929C16.0976 18.6834 16.0976 19.3166 15.7071 19.7071C15.3166 20.0976 14.6834 20.0976 14.2929 19.7071L7.29289 12.7071C7.10536 12.5196 7 12.2652 7 12C7 11.7348 7.10536 11.4804 7.29289 11.2929L14.2929 4.29289C14.6834 3.90237 15.3166 3.90237 15.7071 4.29289Z" fill="#000000"/>
</svg>
```

ê·¸ëŸ¼ ìƒ‰ìƒì„ ì§€ì •í•˜ê³ ì í•˜ëŠ” SVG Iconì— classNameì„ ë¶€ì—¬í•œ í›„, ìì‹ ì´ ì •ì˜í•œ theme css íŒŒì¼ì— ë§ˆì°¬ê°€ì§€ë¡œ CSS Variableë¡œ ì§€ì •í•˜ë©´ ëì…ë‹ˆë‹¤! 
```css
.githubIcon path {
    fill: var(--color-text);
}
```

## Flicker Issue ì—ëŸ¬ í•´ê²°í•˜ê¸°
ë‹¤í¬ ëª¨ë“œ êµ¬í˜„ì— ëŒ€í•œ í‹€ì„ ì¡ì•˜ë‹¤ëŠ” ê¸°ì¨ë„ ì ì‹œ, í˜ì´ì§€ë¥¼ reload ì‹œ  ë¶„ëª… ì´ëŸ° ê¹œë¹¡ì„ í˜„ìƒì„ ê²ªì„ ê²ƒì…ë‹ˆë‹¤...

![](https://velog.velcdn.com/images/damin1025/post/58ff2ef6-95a9-4fea-b04d-3520fb34a879/image.gif)

ëª»ë´¤ë‹¤êµ¬ìš”? ì €ë„ ê·¸ëƒ¥ ì ì‹œ ì¼ì‹œì ìœ¼ë¡œ ì•„ì£¼ ì ê¹ ì´ëŸ¬ëŠ”ê±° ì•„ë‹ê¹Œ..? ã…ã… í–ˆëŠ”ë° ì•„ë‹ˆë”ë¼êµ¬ìš” ğŸ˜£ ì•„ì£¼ ìœ ëª…í•œ <span style="color:red">**Flicker Issue**</span> ì˜€ìŠµë‹ˆë‹¤. 

>The problem is that the HTML is generated long before it reaches the user's device, so there's no way to know which color theme the user prefers. [ì°¸ê³ ](https://www.joshwcomeau.com/css/css-variables-for-react-devs/#dark-mode-flash-fix)

í•´ë‹¹ Issueê°€ ë°œìƒí•œ ì›ì¸ìœ¼ë¡œëŠ”, Gatsbyê°€ HTML íŒŒì¼ì„ ë¹Œë“œí•˜ëŠ” `Pre-Render` íŠ¹ì„±ê³¼ ë°€ì ‘í•œ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤. ë¹„ë¡ localStorageë¡œ ì‚¬ìš©ìê°€ ì„¤ì •í•œ themeì„ ì €ì¥í•œë‹¤ê³  í•´ë„, **reload ì‹œ localStorageë¥¼ ì°¸ì¡°í•˜ëŠ”ê±´ Pre-Render ì‹œì ì´ ì•„ë‹Œ ê·¸ ì´í›„ ì‹œì ì— ì°¸ì¡°**í•˜ê¸° ë•Œë¬¸ì— ì´ëŸ° í˜„ìƒì´ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤. 

ì¦‰ ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ”, localStorageë¥¼ ì°¸ì¡°í•˜ëŠ” ì‹œì ì„ DOM íŠ¸ë¦¬ê°€ êµ¬ì¶•ë˜ê¸° ì´ì „ì— Script íŒŒì¼ì„ ê°•ì œë¡œ Injectioní•˜ëŠ” ë¶€ë¶„ì˜ ì½”ë“œ ì‘ì—…ì´ í•„ìš”í–ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  Gatsbyì—ì„œëŠ” **`html.js` íŒŒì¼ì„ í†µí•´ Script íŒŒì¼ì„ inject í•  ìˆ˜ ìˆë„ë¡ customize**ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤. 

>ğŸ’– [Gatsby html.js customize](https://www.gatsbyjs.com/docs/custom-html/) docsì— `html.js` íŒŒì¼ì„ ìƒì„±í•˜ëŠ” ë¶€ë¶„ì— ëŒ€í•´ ìì„¸í•œ ì„¤ëª…ì´ ìˆìœ¼ë¯€ë¡œ ê¼­ docsë¥¼ ì½ìœ¼ì‹œê³  ì§„í–‰í•˜ì‹œê¸¸!!

ê·¸ëŸ¼ `html.js` íŒŒì¼ì´ ìƒì„±ëê³ , ì €ëŠ” ì•„ë˜ì™€ ê°™ì´ customizeë¥¼ ì§„í–‰í–ˆìŠµë‹ˆë‹¤. 
```js
// html.js
import React from 'react'
import PropTypes from 'prop-types'

export default class HTML extends React.Component {
  render() {
    return (
      <html {...this.props.htmlAttributes}>
        <head>
          <meta charSet="utf-8" />
          <meta httpEquiv="x-ua-compatible" content="ie=edge" />
          <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
          />
          {this.props.headComponents}
        </head>
        <body {...this.props.bodyAttributes} className="light">
          <script
            dangerouslySetInnerHTML={{
              __html: `
			// Customize í•  ë¶€ë¶„
              (function () {
                try {
                  var mode = localStorage.getItem('color-theme');
                  if (!mode) return;
                  document.body.classList.add(mode);
                } catch (e) {}
              })();
            `,
            }}
          />
          {this.props.preBodyComponents}
          <div
            key={`body`}
            id="___gatsby"
            dangerouslySetInnerHTML={{ __html: this.props.body }}
          />
          {this.props.postBodyComponents}
        </body>
      </html>
    )
  }
}

HTML.propTypes = {
  htmlAttributes: PropTypes.object,
  headComponents: PropTypes.array,
  bodyAttributes: PropTypes.object,
  preBodyComponents: PropTypes.array,
  body: PropTypes.string,
  postBodyComponents: PropTypes.array,
}
```
DOM íŠ¸ë¦¬ê°€ êµ¬ì¶•ë˜ê¸° ì§ì „ì— localStorageë¥¼ ì°¸ì¡°í•˜ì—¬ ë¯¸ë¦¬ Themeì´ setting ë  ìˆ˜ ìˆë„ë¡ Scriptë¥¼ ì£¼ì…í–ˆìŠµë‹ˆë‹¤. ì•„ë˜ì™€ ê°™ì´ í•´ë‹¹ Dark mode flicker issueë¥¼ í•´ê²°í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. 

![](https://velog.velcdn.com/images/damin1025/post/9818ade3-3dbd-4eca-a24f-0eaf7c0f70a1/image.gif)

ì‹¤ì œ deployëœ element ì½”ë“œë¥¼ ë³´ë©´ script injectionì´ ì˜ ëìŒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

![](https://velog.velcdn.com/images/damin1025/post/c6c1144e-5caa-490d-b842-7ee175488c7c/image.PNG)

## ğŸ”® Utteranceì— ë‹¤í¬ëª¨ë“œ ì ìš©í•˜ê¸° 
ì œ ê°œë°œ ë¸”ë¡œê·¸ì—ëŠ” ëŒ“ê¸€ ê¸°ëŠ¥ìœ¼ë¡œ `Utterance` ì˜¤í”ˆ ì†ŒìŠ¤ë¥¼ í™œìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤. 

ì´ë•Œ UtteranceëŠ” ë‹¤ë¥¸ ìš”ì†Œë“¤ê³¼ëŠ” ë‹¬ë¦¬, `Div` elementë¥¼ ì§ì ‘ ìƒì„±í•˜ê³  ê·¸ë¦¬ê³  `attributes`ì— repo ë“±ë“± ì†ì„±ì„ ì§€ì •í•˜ê³  ê·¸ë¦¬ê³  ê·¸ ì§€ì •í•œ ê°’ì— ëŒ€í•´ì„œ DOM íŠ¸ë¦¬ì— appendChild í•˜ì—¬ ìƒì„±ë˜ê¸° ë•Œë¬¸ì— ë‹¤í¬ëª¨ë“œ êµ¬í˜„ì— ëŒ€í•´ CSS Variableë¡œ ì–´ë–»ê²Œ ì§€ì •í•´ì•¼ ë˜ëŠ”ì§€ êµ¬ìƒì´ ì˜ ë– ì˜¤ë¥´ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

Utterance ìš”ì†ŒëŠ” `Div`ë¡œ ìƒì„±ë˜ì§€ ì•Šê³  `iframe`ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤. 
ë”°ë¼ì„œ `iframe` íƒœê·¸ì— ì ‘ê·¼í•˜ì—¬ themeì„ ë°”ê¾¸ëŠ” ë¶€ë¶„ì„ `window.postMessage()`ë¡œ ì „ë‹¬í•˜ì—¬ ì ‘ê·¼í–ˆì–´ì•¼ í–ˆìŠµë‹ˆë‹¤.

> `window.postMessage()` ë©”ì†Œë“œëŠ” Window ì˜¤ë¸Œì íŠ¸ ì‚¬ì´ì—ì„œ ì•ˆì „í•˜ê²Œ cross-origin í†µì‹ ì„ í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ì˜ˆì‹œë¡œ, í˜ì´ì§€ì™€ ìƒì„±ëœ íŒì—… ê°„ì˜ í†µì‹ ì´ë‚˜, í˜ì´ì§€ì™€ í˜ì´ì§€ ì•ˆì˜ iframe ê°„ì˜ í†µì‹ ì— ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì¶œì²˜: [MDN](https://developer.mozilla.org/ko/docs/Web/API/Window))

ì œ í”„ë¡œì íŠ¸ì—ì„œ **ë‹¤í¬ëª¨ë“œì˜ ì „í™˜ ìœ ë¬´ì˜ í¬ì¸íŠ¸ëŠ” bodyì˜ className**ì…ë‹ˆë‹¤. lightëƒ darkëƒì— ë”°ë¼ì„œ DOM íŠ¸ë¦¬ê°€ êµ¬ì¶•ë ë•Œ, bodyì˜ classNameì— ë”°ë¼ ìœ ë™ì ìœ¼ë¡œ ë³€í™”í•  ìˆ˜ ìˆëŠ” ideaê°€ í•„ìš”í–ˆìŠµë‹ˆë‹¤. êµ¬ê¸€ë§ ê²°ê³¼, `MutationObserver` ë¼ëŠ” Constructorê°€ ì´ ê°œë…ì„ í™œìš©í•  ìˆ˜ ìˆë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤. [ì°¸ê³ ](https://hacks.mozilla.org/2012/05/dom-mutationobserver-reacting-to-dom-changes-without-killing-browser-performance/)

```tsx
useEffect(() => {
    const mutationObserver: MutationObserver = new MutationObserver(
      mutationsList => {
        mutationsList.forEach(mutation => {
          if (mutation.attributeName === 'class') {
            if (window.document.querySelector('.utterances-frame')) {
              const theme = mutation.target.classList.contains('dark')
                ? 'photon-dark'
                : 'github-light'
              const message = {
                type: 'set-theme',
                theme: theme,
              }
              const iframe =
                window.document.querySelector('.utterances-frame')
              iframe.contentWindow.postMessage(message, src)
            }
          }
        })
      },
    )
    mutationObserver.observe(document.body, { attributes: true })
  }, [])
```
ê°ì§€ëœ bodyì˜ classNameì— ë”°ë¼ ì‚¼í•­ì—°ì‚°ìë¡œ themeì„ í• ë‹¹ í›„, iframeì— postMessage()ë¡œ messageë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  `attributes`ì˜ ìƒíƒœê°’ì„ trueë¡œ ì§€ì •í•˜ì—¬, bodyì˜ classì˜ ë³€í™”ë¥¼ ê°ì§€í•  ìˆ˜ ìˆë„ë¡ ìˆ˜í–‰í•©ë‹ˆë‹¤. 
ë˜í•œ ì´ ì´ë²¤íŠ¸ë¥¼ mount ì‹œì ì— trigger ë  ìˆ˜ ìˆë„ë¡ `useEffect()` Hookë‚´ì— ì„ ì–¸í–ˆìŠµë‹ˆë‹¤. ì´ëŠ” index(í™ˆ í™”ë©´)ì—ì„œ ë‹¤í¬ ëª¨ë“œë¡œ í† ê¸€ í›„, í¬ìŠ¤íŠ¸ë¥¼ í´ë¦­í•˜ì—¬ utterance themeì´ ë°”ë¡œ ì ìš©ë  ìˆ˜ ìˆë„ë¡ í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤. 

### ê²°ê³¼ë¬¼
![](https://velog.velcdn.com/images/damin1025/post/c7799ac4-2bbe-466e-95ca-d1c33a3a491e/image.gif)

íœ´ .. ê°œì¸ì ìœ¼ë¡œ ì–´ë ¤ì› ë˜ ë¶€ë¶„ ì¤‘ í•˜ë‚˜ì˜€ëŠ”ë° ì˜ ì‘ë™í•´ì„œ ì–´ì°Œë‚˜ í–‰ë³µí•˜ë˜ì§€ğŸ’™


## ë§ˆë¬´ë¦¬ 
ì‚¬ì‹¤ ì´ ê¸€ì„ ì“°ë©´ì„œ ì—¥ ì´ê²ƒë°–ì— ì•ˆëœë‹¤ê³ ? ìƒê°ì´ ë“¤ ì •ë„ë¡œ, ë‹¤í¬ëª¨ë“œ êµ¬í˜„ì€ ê½¤ë‚˜ ë³µì¡í•˜ê³  ê·¸ë¦¬ê³  ê¼¼ê¼¼í•¨ì„ ê¸°ìš¸ì´ëŠ” ì‘ì—…ì´ì—ˆìŠµë‹ˆë‹¤. ì•„ë¬´ë˜ë„ ì‚¬ìš©ì ê²½í—˜ì— í° ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ìš”ì†Œì´ê¸° ë•Œë¬¸ì— ë”ìš±ì´ ì‹ ê²½ì„ ì“¸ ìˆ˜ ë°–ì— ì—†ì—ˆë˜ ì‘ì—…ì´ì—ˆìŠµë‹ˆë‹¤.  

ì–´ë–¤ ê¸°ìˆ ì„ ì„ íƒí•´ì•¼ í• ì§€, ê·¸ë¦¬ê³  ì–´ë–¤ íƒœê·¸ì— ìƒ‰ìƒ ë³€í™”ê°€ í•„ìš”í•œì§€, ë˜í•œ ë Œë”ë§ ì´ìŠˆë„ handling í–ˆì–´ì•¼ í–ˆê³  ì •ë§.. ì˜¤ëœ ì‘ì—… ëì— ì–´ëŠì •ë„ êµ¬ìƒ‰ì„ ê°–ì¶˜ê²ƒ ê°™ìŠµë‹ˆë‹¤.. (4ì›”ë§ë¶€í„° ì‹œì‘í–ˆìœ¼ë‹ˆ..) 

ì €ë„ ì²˜ìŒìœ¼ë¡œ ì œëŒ€ë¡œ ê°ì¡ê³  ë§Œë“  ë‹¤í¬ëª¨ë“œë¼ ë¶€ì¡±í•œ ì ì´ ìˆì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤ğŸ˜‚ í”¼ë“œë°±ì€ ì–¸ì œë‚˜ í™˜ì˜ì…ë‹ˆë‹¤! 

### ğŸ™‡ğŸ¼â€â™€ï¸ ì°¸ê³  
**-ë‹¤í¬ëª¨ë“œ CSS Variable ë° flicker Issue-**

https://blog.maximeheckel.com/posts/switching-off-the-lights-part-2-fixing-dark-mode-flashing-on-servered-rendered-website/

https://blog.rhostem.com/posts/2020-06-25-dark-mode-for-gatsby-website

https://github.com/gaearon/overreacted.io/blob/master/src/html.js

**-Utterance dark mode-**

https://www.sungikchoi.com/blog/gatsby-dark-mode/

**-MutationObserver-**

https://mong-blog.tistory.com/entry/JS-DOM%EC%9D%84-%EA%B0%90%EC%8B%9C%ED%95%98%EB%8A%94-MutationObserver

https://hacks.mozilla.org/2012/05/dom-mutationobserver-reacting-to-dom-changes-without-killing-browser-performance/

https://developer.chrome.com/blog/detect-dom-changes-with-mutation-observers/

https://stackoverflow.com/questions/31659567/performance-of-mutationobserver-to-detect-nodes-in-entire-dom
