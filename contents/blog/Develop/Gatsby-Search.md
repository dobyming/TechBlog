---
date: '2023-06-08'
title: 'Gatsby ë¸”ë¡œê·¸ - ê²€ìƒ‰ê¸°ëŠ¥ êµ¬í˜„í•˜ê¸°ğŸ”'
categories: ['Web', 'Gatsby']
summary: 'ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„  Gatsby ë¸”ë¡œê·¸ì— ê²€ìƒ‰ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ì„œ ì ì–´ë³´ë ¤ê³  í•©ë‹ˆë‹¤.'
thumbnail: '../../images/gatsby.jpg'
---
## ë™ê¸°
ë™ê¸°ë¼ê³  ê±°ì°½í•˜ê²Œ ì¨ë†¨ì§€ë§Œ ë³„ê±° ì—†ìŠµë‹ˆë‹¤. ì•ìœ¼ë¡œ ì´ ë¸”ë¡œê·¸ë¥¼ í‰ìƒ ì“¸ ì˜ˆì •ì¸ë°.. ê·¸ëŸ¼ ì§€ê¸ˆë³´ë‹¤ í¬ìŠ¤íŒ… ìˆ˜ë„ ë” ë§ì•„ì§ˆê±°ê³ . ê·¸ëŸ¬ë©´ ë‚´ê°€ ì¼ì¼ì´ ë¬´í•œ ìŠ¤í¬ë¡¤ë¡œ ë‚´ë ¤ì„œ ê¸€ì„ ì°¾ëŠ” í–‰ìœ„ ìì²´ê°€ êµ‰ì¥íˆ ë¶ˆí¸í•œë°? 

ì •ë§ ì´ ì‚¬ê³ ì˜ íë¦„ëŒ€ë¡œ ìƒê°í–ˆê³  ì´ ê³ ë¯¼ì— ëŒ€í•œ ê²°ë¡ ì€ "ê·¸ë˜. ê²€ìƒ‰ ê¸°ëŠ¥ì„ ë§Œë“¤ì–´ë³´ì!" ë¡œ ê·€ê²°ëìŠµë‹ˆë‹¤. 


## ê²°ê³¼ í™”ë©´
![](https://velog.velcdn.com/images/damin1025/post/515c2fd7-c31e-4497-81c5-65f39ba31a30/image.gif)
ê²°ê³¼ í™”ë©´ì€ ìœ„ì™€ ê°™ì´ ê²€ìƒ‰ ì•„ì´ì½˜ì„ í´ë¦­ í›„ ê²€ìƒ‰ í˜ì´ì§€ë¡œ ì´ë™í•˜ì—¬ keywordë¥¼ ê²€ìƒ‰í•˜ë©´ ì•„ë˜ì— ê´€ë ¨ í¬ìŠ¤íŒ…ì´ ë‚˜ì—´ë˜ê³  ê·¸ë¦¬ê³  ì›í•˜ëŠ” í¬ìŠ¤íŒ…ìœ¼ë¡œ ì´ë™í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬í˜„ì— ì§„í–‰í–ˆìŠµë‹ˆë‹¤. 


## ì–´ë–¤ ê¸°ìˆ ì„ ì„ íƒí•  ê²ƒì¸ê°€
[ê³µì‹ docs](https://www.gatsbyjs.com/docs/how-to/adding-common-features/adding-search/)ë¥¼ ë³´ë©´ gatsbyì— ê²€ìƒ‰ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ í¬ê²Œ 2ê°€ì§€ë¡œ ì†Œê°œí•˜ê³  ìˆìŠµë‹ˆë‹¤.

ì²« ë²ˆì§¸ ë°©ë²•ì€ **í´ë¼ì´ì–¸íŠ¸ ì¸¡ ê²€ìƒ‰**ì…ë‹ˆë‹¤. ë¹Œë“œ ë˜ëŠ” ëŸ°íƒ€ì„ì— ë°ì´í„°ë¥¼ ì¸ë±ì‹±í•˜ê³  ì´ë¥¼ ì´ìš©í•´ ë¡œì»¬ì—ì„œ ê²€ìƒ‰ì„ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. ê³µì‹ docsì—ì„œëŠ” `js-search`, `gatsby-plugin-elasticlunr-search`, `gatsby-plugin-local-search` ë¥¼ ì œì‹œí•˜ê³  ìˆìŠµë‹ˆë‹¤.

ë‘ ë²ˆì§¸ ë°©ë²•ì€ **APIê¸°ë°˜ ê²€ìƒ‰ì—”ì§„**ì„ í™œìš©í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ì™¸ë¶€ ì„œë¹„ìŠ¤ë¥¼ í™œìš©í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ë¹Œë“œ ì‹œì ì— ê²€ìƒ‰ ëŒ€ìƒ ë°ì´í„°ë“¤ì„ ì¸ë±ì‹±í•´ ì™¸ë¶€ ì„œë¹„ìŠ¤ì— ì˜¬ë ¤ë‘ê³  ëŸ°íƒ€ì„ì—ëŠ” APIë¡œ ê²€ìƒ‰í•©ë‹ˆë‹¤.

í•˜ì§€ë§Œ APIê¸°ë°˜ ê²€ìƒ‰ì—”ì§„ ì‚¬ìš© ì‹œ ë¸”ë¡œê·¸ì˜ ë¹Œë“œ ë°°í¬ í”„ë¡œì„¸ìŠ¤ì— ì¸ë±ìŠ¤ë¥¼ ì „ì†¡í•´ì•¼í•˜ê³  ì‚¬ìš© ì‹œ ë¹„ìš©ì´ ë°œìƒí•˜ê±°ë‚˜ ê·¸ë¦¬ê³  ë¬´ë£Œì¸ ê²½ìš° íšŸìˆ˜ì— ì œì•½ì´ ìˆì–´ êµ³ì´ ì‚¬ìš©í•´ì•¼ í•  ì´ìœ ëŠ” ì°¾ì§€ ëª»í–ˆê³ , í´ë¼ì´ì–¸íŠ¸ ì¸¡ ê²€ìƒ‰ ë°©ë²•ì´ ë¸”ë¡œê·¸ì— ë¶€ë‹´ì´ ëœ ê°ˆê²ƒ ê°™ì€ ë°©ì‹ì´ë¼ê³  ìƒê°í•˜ì—¬ ì €ëŠ” ì²«ë²ˆì§¸ ë°©ë²•ìœ¼ë¡œ ì•„ì´ë””ì–´ë¥¼ schemeí–ˆìŠµë‹ˆë‹¤.

## ê²€ìƒ‰ ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ 
ì—¬ëŸ¬ Gatsby Starterì— êµ¬í˜„ëœ ê²€ìƒ‰ ê¸°ëŠ¥ì„ ì°¸ê³ í•´ë´¤ì„ë•Œ, GraphQLì—ì„œ ìš”ì²­í•œ edgesë¥¼ ëª¨ë‘ ëŒì•„ ê°’ì„ ë¶ˆëŸ¬ì˜¤ê³ , ê·¸ë¦¬ê³  ê·¸ ê°’ì„ ëŒë©´ì„œ searchí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬í˜„ëœ ë°©ì‹ì´ ë§ì•˜ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ search ì‹œ, ëª¨ë“  ë°°ì—´ì˜ ì‚¬ì´ì¦ˆì— dependí•˜ê¸° ë•Œë¬¸ì— `O(N) time`ì´ ì†Œìš”ë˜ëŠ” ê²ƒì„ ìƒê°í•˜ë©´ ì¶”í›„ í¬ìŠ¤íŒ… ì–‘ì´ ë§ì•„ì§€ê²Œ ë ë•Œ ê²€ìƒ‰ ì†ë„ ì €í•˜ë¥¼ ì•¼ê¸°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ê²€ìƒ‰ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•˜ëŠ” ê²ƒì´ ì‹œê°„ ë³µì¡ë„ë©´ì—ì„œ ë‚˜ì„ê²ƒ ê°™ë‹¤ëŠ” íŒë‹¨ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤. 

ê²€ìƒ‰ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ êµ¬í˜„ ì‹œ, ì•„ë˜ì™€ ê°™ì€ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. 

- ì¸ë±ì‹±ìœ¼ë¡œ ë¹ ë¥¸ ê²€ìƒ‰
- ê²€ìƒ‰í•˜ë ¤ëŠ” ì½˜í…ì¸ (ì œëª© í˜¹ì€ ë³¸ë¬¸)ì— ë” ê°€ì¤‘ì¹˜ë¥¼ ë‘˜ ìˆ˜ ìˆë‹¤
- ê²€ìƒ‰ì–´ í•˜ì´ë¼ì´íŒ… ê¸°ëŠ¥
- ê²€ìƒ‰ì— and, orê³¼ ê°™ì€ ë…¼ë¦¬ ì—°ì‚° ì ìš© ê°€ëŠ¥

ê·¸ëŸ¼ ì–´ë–¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ì´ë¥¼ ì‹¤í˜„í•  ìˆ˜ ìˆì„ê¹Œ ê³ ë¯¼ì„ í•˜ë˜ ì¤‘ì— [í•´ë‹¹ ë¸”ë¡œê·¸](https://velog.io/@seyoung8239/Gatsby-%EB%B8%94%EB%A1%9C%EA%B7%B8-%EA%B2%80%EC%83%89%EA%B8%B0%EB%8A%A5-%EB%8F%84%EC%9E%85%ED%95%98%EA%B8%B0)ì—ì„œ ì•„ì´ë””ì–´ë¥¼ ì–»ì–´ê°ˆ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

`flexsearch` ë‚˜ `lunr` ê°™ì€ ê²½ìš°ëŠ” í•œê¸€ ê²€ìƒ‰ì–´ ì´ìŠˆê°€ ìˆê³ (ì˜ë¬¸ì— íŠ¹í™”) `js-search`ëŠ” ê·¸ ìƒíƒœê³„ê°€ ì•„ì§ ì¢ì•˜ê¸°ì— `fuse.js` ë°©ì‹ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤. 

## fuse.js ê²€ìƒ‰ 
[fuse.js](https://fusejs.io/)ëŠ” fuzzyí•˜ê²Œ searchí•œë‹¤ì—ì„œ ì°©ì•ˆëìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ fuzzyë€ **ëŒ€ëµì ìœ¼ë¡œ ê²€ìƒ‰**í•œë‹¤ì˜ ì˜ë¯¸ë¥¼ ì§€ë‹ˆê³  ìˆìŠµë‹ˆë‹¤. 

ê°€ì¥ í° ì¥ì ì€ ë°±ì—”ë“œì˜ ì§€ì›ì´ í•„ìš” ì—†ê³ , ë‹¤ë¥¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— dependencyë¥¼ ê°–ê³  ìˆì§€ ì•Šìœ¼ë©° ê²°ì •ì ìœ¼ë¡œ **í´ë¼ì´ì–¸íŠ¸ ì¸¡ ê²€ìƒ‰**ê¸°ë°˜ì´ë¼ëŠ” ê²ƒì´ì—ˆìŠµë‹ˆë‹¤. 

### Gatsbyì—ì„œ fuse.js ì‚¬ìš©í•˜ê¸°
Gatsby ë¹Œë“œ ê³¼ì •ì—ì„œ ëª©ë¡ì„ ì¸ë±ì‹±í•˜ì—¬ ì–´ë”˜ê°€ ì €ì¥í•´ë‘ì–´ì•¼ í•˜ê³  ì´ë ‡ê²Œ ìƒì„±ëœ ë°ì´í„°ëŠ” ë¸”ë¡œê·¸ì˜ ëŸ°íƒ€ì„ì— fuse.js ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ì‚¬ìš©í•˜ë„ë¡ êµ¬ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

ì´ë•Œ ë¹Œë“œ ê³¼ì •ì€ í”ŒëŸ¬ê·¸ì¸ì„ í™œìš©í•˜ë©´ ë˜ê³  ëŸ°íƒ€ì„ ê²€ìƒ‰ì€ hookì„ í™œìš©í•˜ë©´ ë©ë‹ˆë‹¤.

### gatsby-plugin-fusejs
[gatsby-plugin-fusejs](gatsby-plugin-fusejs) í•´ë‹¹ docsì˜ npm ëª…ë ¹ì–´ë¥¼ followí•˜ì—¬ ì„¤ì¹˜ë¥¼ ì§„í–‰ í›„, configë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. 

```js
// gatsby-config.js
	{
      resolve: `gatsby-plugin-fusejs`,
      options: {
        // ì¸ë±ìŠ¤ë¥¼ ë§Œë“¤ê³ ì í•˜ëŠ” ë°ì´í„°ì˜ ì¿¼ë¦¬
        query: `
          {
            allMarkdownRemark {
              nodes {
                id
                rawMarkdownBody
                fields {
                  slug
                }
                frontmatter {
                  title
                }
              }
            }
          }
        `,
        // ì¸ë±ìŠ¤ë¥¼ ë§Œë“¤ê³ ì í•˜ëŠ” ë°ì´í„°ì˜ í”„ë¡œí¼í‹°
        keys: ['title', 'body'],
        // graphqlì˜ ê²°ê³¼ë¬¼ì„ ë‹¨ìˆœ ê°ì²´ ë°°ì—´ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
        normalizer: ({ data }) =>
          data.allMarkdownRemark.nodes.map((node) => ({
            id: node.id,
            path: node.fields.slug,
            title: node.frontmatter.title,
            body: node.rawMarkdownBody,
          })),
      },
    },
```
ì„¤ì¹˜ í›„ gatsby-config.jsì— ì¸ë±ìŠ¤ë¡œ ë§Œë“¤ì–´ì§€ê¸° ì›í•˜ëŠ” ë°ì´í„°ì˜ ì¿¼ë¦¬, ë°ì´í„° ì¤‘ì—ì„œë„ ê²€ìƒ‰ì´ ë˜ì—ˆìœ¼ë©´ í•˜ëŠ” í”„ë¡œí¼í‹°, GraphQL ê²°ê³¼ë¬¼ì„ ê°ì²´ ë°°ì—´ë¡œ ë³€í™˜í•˜ê¸° ìœ„í•œ í•¨ìˆ˜ë¥¼ ì˜µì…˜ìœ¼ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤. 

![](https://velog.velcdn.com/images/damin1025/post/4ad55151-b71b-474f-bb50-aea87c69e6d3/image.PNG)

GraphQL ì‚¬ì´íŠ¸ì— ì ‘ì† ì‹œ, `allFusejs` í•„ë“œê°€ ì¶”ê°€ ë¨ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### react-use-fusejs
ë‹¤ìŒìœ¼ë¡  ë§Œë“¤ì–´ì§„ ì¸ë±ìŠ¤ë¥¼ í™œìš©í•˜ê¸° ìœ„í•´ ëŸ°íƒ€ì„ì— hookì„ í™œìš©í•˜ì—¬ ê²€ìƒ‰ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤. 

ì´ë•Œ ë§¤ë²ˆ ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥ ì‹œ, ì¸ë±ìŠ¤ë¥¼ parsing í›„ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê²Œ ë˜ë©´ ì¶”í›„ í¬ìŠ¤íŒ…ì˜ ì–‘ì´ ë§ì•„ì§ˆë•Œ ìì›ì´ ë‚­ë¹„ë©ë‹ˆë‹¤. (Props Drilling) 
ë”°ë¼ì„œ ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œ index í˜ì´ì§€ë¥¼ ì²˜ìŒ Search í˜ì´ì§€ë¥¼ í´ë¦­ í–ˆì„ë•Œ ëª¨ë‘ ë‹¤ìš´ë°›ê³  ê·¸ë¦¬ê³  ê·¸ ë‹¤ìš´ë°›ì€ dataë“¤ì„ contextì— ë‹´ì•„ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ìœ ë„í•˜ëŠ” ê²ƒì´ ë” íš¨ìœ¨ì ì¼ê²ƒì…ë‹ˆë‹¤. 

```tsx
/* Search.tsx */

  // index.js(ìµœìƒìœ„)ë¡œë¶€í„° ë‹¤ìš´ í›„ íŒŒì‹±í•˜ì—¬ ê²€ìƒ‰ì„ ìˆ˜í–‰
  const data = useStaticQuery<SearchProps>(graphql`
    {
      fusejs {
        publicUrl
      }
    }
  `)

  /**
   * 1. Get User Search Input value
   * 2. Collect all Index data and store in context
   * 3. Based on fuseData find query data with fuzzy search
   * 4. Lazy Loading (when Post's amount is getting larger)
   */
  const [query, setQuery] = useState<string>('')
  const { fuseData, setFuseData } = useContext(AppContext)
  const result = useGatsbyPluginFusejs<SearchItem>(query, fuseData)
  const [isFetching, setIsFetching] = useState(false)

  const fetching = useRef(false)
  useEffect(() => {
    if (!fetching.current && !fuseData && query) {
      fetching.current = true

      fetch(data.fusejs.publicUrl)
        .then(res => res.json())
        .then(data => setFuseData(data))
        .finally(() => setIsFetching(false))
    }
  }, [fuseData, query, setFuseData])
```

ì¸ë±ìŠ¤ë¥¼ ì¬ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ contextì— ë‹´ì„ ê²ƒì´ê³ , ì´ëŠ” ìµœìƒìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ êµ¬í˜„í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤. ë”°ë¼ì„œ `context` í´ë”ë¥¼ ìƒˆë¡œ ìƒì„±í•˜ê³ , `app.tsx` íŒŒì¼ì„ ìƒˆë¡œ ë§Œë“¤ì–´ì„œ ì•„ë˜ì™€ ê°™ì´ contextë¥¼ App â¡ Searchë¡œ dataë¥¼ ìœ„ì„í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. 

```tsx
/* app.tsx */

import React, {
  createContext,
  SetStateAction,
  useState,
  ReactNode,
  FunctionComponent,
} from 'react'
import { Dispatch } from 'react'

interface AppContext {
  fuseData: any
  setFuseData: Dispatch<SetStateAction<any>>
}

export const AppContext = createContext<AppContext>({
  fuseData: null,
  setFuseData: () => {},
})

type AppProps = {
  children: ReactNode
}

// Provide Props to Search
const AppProvider: FunctionComponent<AppProps> = function ({ children }) {
  const [fuseData, setFuseData] = useState(null)

  return (
    <AppContext.Provider value={{ fuseData, setFuseData }}>
      {children}
    </AppContext.Provider>
  )
}

export default AppProvider
```
ì´ë•Œ Providerì— valueë¥¼ ë‹´ì„ë•Œ ê°ì²´ë¡œ í•œë²ˆ ë” ê°ì‹¸ì„œ ë³´ë‚´ì£¼ëŠ” ì´ìœ ëŠ” dataì˜(state) ê°’ì´ ë³€ê²½ë ë•Œ setFuseDataëŠ” ì¬ìƒì„±ë˜ì§€ ì•Šì§€ë§Œ, fuseDataê°€ ì¬ìƒì„±ë˜ì§€ ì•Šë„ë¡ í•˜ê¸° ìœ„í•´ ê°ì‹¸ì„œ ë³´ëƒ…ë‹ˆë‹¤. 

```js
// gatsby-browser.js
import { AppProvider } from './src/context/app'
 
export const wrapRootElement = ({ element }) => {
  return <AppProvider>{element}</AppProvider>
}
```

ìœ„ì™€ ê°™ì´ ì½”ë“œë¥¼ ëª¨ë‘ êµ¬ì„± ì‹œ, React-Developer-Toolsë¥¼ í™•ì¸í•˜ë©´ Contextì— post ì •ë³´ë“¤ì´ ë‹´ê²¨ìˆëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥ ì‹œ, í•´ë‹¹ ê°’ë“¤ì€ ì´ë¯¸ ë‹´ê²¨ìˆì–´ ìì›ì˜ ë‚­ë¹„ë¥¼ ìµœì†Œí™” í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
![](https://velog.velcdn.com/images/damin1025/post/3258df66-245c-4b99-84aa-6f0d09f7371e/image.PNG)


## ë°°í¬ í›„ ì„±ëŠ¥ check

![](https://velog.velcdn.com/images/damin1025/post/56f43f3a-a80b-42e2-8091-35326e624444/image.PNG)

ê²€ìƒ‰ ê¸°ëŠ¥ ì¶”ê°€ í›„, lightHouse ì ìˆ˜ë¥¼ í™•ì¸í•´ë³¸ ê²°ê³¼ í¼í¬ì—ì„œ 1ì  ê¹ì¸ê²ƒ ë¹¼ê³¤ ëª¨ë‘ 100ì„ ìœ ì§€í–ˆë‹¤..!! 
