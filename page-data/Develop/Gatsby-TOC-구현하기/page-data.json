{"componentChunkName":"component---src-templates-post-template-tsx","path":"/Develop/Gatsby-TOC-구현하기/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p>🤠 글이 꽤 깁니다!</p>\n<h2 id=\"-동기\" style=\"position:relative;\"><a href=\"#-%EB%8F%99%EA%B8%B0\" aria-label=\" 동기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💭 동기</h2>\n<p>포스팅을 읽다 보면, 다시 읽고 싶은 부분으로 돌아가고 싶었던 경험이 있을 겁니다. 이때 일일이 스크롤 해서 내가 원하는 콘텐츠를 읽는 것은 사용자 경험이 굉장히 떨어지는 행위입니다.</p>\n<p>따라서 많은 개발 블로그에는 <strong>TOC</strong>, 즉 Table Of Contents를 제공합니다. 저 역시 제 블로그에 방문해 주시는 유저분들께 편리함을 제공하고자 TOC 기능을 제작하고 구현에 진행했습니다.</p>\n<p>Velog나 다른 개발 블로그들에서 봤을 땐 복잡할 거라고 생각은 안 했는데, 역시 만만한 건 아무것도 없었습니다😅</p>\n<h2 id=\"결과\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EA%B3%BC\" aria-label=\"결과 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결과</h2>\n<p>먼저 구현 결과부터 보여드리겠습니다.</p>\n<p>스크롤 시, 일정 위치에 heading이 scope 시 오른쪽에 있는 TOC의 각각의 요소들에 active 값이 활성화됨을 볼 수 있습니다.\r\n<img src=\"https://velog.velcdn.com/images/damin1025/post/021cd97b-05b8-470c-8d95-1c82fe32e9e7/image.gif\" alt=\"\"></p>\n<p>그리고 각 콘텐츠를 클릭 시, 알맞는 heading으로 direct 하게 이동합니다.\r\n<img src=\"https://velog.velcdn.com/images/damin1025/post/ed65ab46-8384-4b63-8db1-f060334ae8a5/image.gif\" alt=\"\"></p>\n<p>그럼 제가 어떤 flow로 TOC 기능을 개발했는지 회고하고자 합니다.</p>\n<h2 id=\"header를-어떻게-갖고-올것인가\" style=\"position:relative;\"><a href=\"#header%EB%A5%BC-%EC%96%B4%EB%96%BB%EA%B2%8C-%EA%B0%96%EA%B3%A0-%EC%98%AC%EA%B2%83%EC%9D%B8%EA%B0%80\" aria-label=\"header를 어떻게 갖고 올것인가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>header를 어떻게 갖고 올것인가?</h2>\n<p>우선 TOC 기능을 구현하는 데 있어, 가장 중요한 것은 포스팅에 있는 header를 어떻게 갖고 올 것인가입니다. 당연하게도 <code class=\"language-text\">gatsby-node.js</code>에서 GraphQL로 요청해야 하는데, 이때 어떤 필드를 참조할 것인가를 생각해 봐야 합니다.</p>\n<ol>\n<li><code class=\"language-text\">tableOfContents</code> 필드를 활용하기</li>\n</ol>\n<p><code class=\"language-text\">tableOfContents</code> 필드를 GraphQL로 요청하여 <code class=\"language-text\">dangerouslySetInnerHTML</code>에 __html 요소로 Props를 보내서 렌더링 하는 방법이 있습니다.\r\n<img src=\"https://velog.velcdn.com/images/damin1025/post/dde204d0-a5ed-41f9-808e-dc0ab46cfef6/image.PNG\" alt=\"\"></p>\n<ol start=\"2\">\n<li><code class=\"language-text\">headings</code> 필드의 depth와 value를 활용하기</li>\n</ol>\n<p><img src=\"https://velog.velcdn.com/images/damin1025/post/eacbf940-6312-4203-8750-93f29f440712/image.PNG\" alt=\"\"></p>\n<p>여기서 depth는 h1, h2,…에서 숫자에 해당하는 부분이고, value는 제목입니다. 저는 직접 depth를 handle 하여 CSS도 Styling 할 것이고, 그리고 배열을 돌면서 value를 TOC 컴포넌트에 렌더링 하고 싶었기 때문에 1번보단 2번 방법을 택했습니다.</p>\n<h2 id=\"value를-어떻게-slug화-할것인가\" style=\"position:relative;\"><a href=\"#value%EB%A5%BC-%EC%96%B4%EB%96%BB%EA%B2%8C-slug%ED%99%94-%ED%95%A0%EA%B2%83%EC%9D%B8%EA%B0%80\" aria-label=\"value를 어떻게 slug화 할것인가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Value를 어떻게 slug화 할것인가?</h2>\n<p>보통 <code class=\"language-text\">tableOfContents</code> 필드를 활용해서 구현한다면 slug를 자체적으로 알아서 만들어서 <code class=\"language-text\">href</code>로 접근할 수 있도록 값이 부여되는데, 저같은 경우는 <code class=\"language-text\">headings</code>를 활용하기 때문에 <strong>제목을 어떻게 slug 화할 것인가</strong>를 고민해 봤어야 했습니다.</p>\n<p>정말 npm은 없는게 없군요.. <a href=\"https://www.npmjs.com/package/github-slugger\" target=\"_blank\" rel=\"nofollow\">github-slugger</a> 라는 패키지를 통해서 slug에 대한 고민을 해결할 수 있었습니다. 해당 패키지를 npm으로 설치하고, <code class=\"language-text\">slug(value)</code> 메서드만 선언하면 알아서 value(제목)를 slug화 해주는 아주 친절한 패키지를 활용하여 해당 고민을 해결할 수 있었습니다.</p>\n<h2 id=\"data-흐름은\" style=\"position:relative;\"><a href=\"#data-%ED%9D%90%EB%A6%84%EC%9D%80\" aria-label=\"data 흐름은 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Data 흐름은?</h2>\n<p><img src=\"https://velog.velcdn.com/images/damin1025/post/6f0fe709-8358-4507-aba0-ca1bc62cb64a/image.PNG\" alt=\"\"></p>\n<p>데이터 흐름은 위와 같이 <code class=\"language-text\">post_template.tsx</code> (포스팅 템플릿)에서 GraphQL로 요청한 headings(depth,value)를 <code class=\"language-text\">PostTOC.tsx</code> 에 전달하는 구조로 설계하고 구현에 진행했습니다.</p>\n<h2 id=\"toc-컴포넌트-styling\" style=\"position:relative;\"><a href=\"#toc-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-styling\" aria-label=\"toc 컴포넌트 styling permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TOC 컴포넌트 Styling</h2>\n<p>자 그럼 GraphQL로 요청한 headings들을 이쁘게 Render하기 위해  Styling 작업을 해야 합니다.</p>\n<p>사실 TOC 기능을 만들면서 꽤 시간을 많이 들였던 부분이 바로 이 Styling 부분이기도 했습니다. CSS적으로 deep하게 MockUp 했고.. 따라서 이건 본인이 스스로 고민하면서 만드는 것을 추천드립니다. 제 코드를 봐도 본인 프로젝트에서는 또 적용이 안될수도 있기 때문입니다 ㅠ</p>\n<p>이건 제가 Scheme한 부분입니다.\r\n<img src=\"https://velog.velcdn.com/images/damin1025/post/dd2ad444-f17c-4215-9d85-52ff52623c6d/image.jpg\" alt=\"\">\r\n이런식으로 본인이 스스로 한번 구상하시는 것을 추천드립니다 🐣 그리고 포스팅을 읽을때, TOC 컴포넌트가 <strong>일정 위치에 고정</strong>되도록 구현하고 싶었기 때문에 <code class=\"language-text\">Sticky</code> 속성을 부여했습니다.</p>\n<p>또한 다크모드로 전환 시, 콘텐츠들의 글자색들이 바뀌어야 하기 때문에 body의 classList가 ‘dark’면 바뀔 수 있도록 값을 부여했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">a</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token selector\">color: $</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">isBrowser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> &amp;&amp; window.document.body.classList.<span class=\"token function\">contains</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dark'</span><span class=\"token punctuation\">)</span>\r\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token property\">text-decoration</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"scroll시-각-header에-맞게-active-기능-부여하기\" style=\"position:relative;\"><a href=\"#scroll%EC%8B%9C-%EA%B0%81-header%EC%97%90-%EB%A7%9E%EA%B2%8C-active-%EA%B8%B0%EB%8A%A5-%EB%B6%80%EC%97%AC%ED%95%98%EA%B8%B0\" aria-label=\"scroll시 각 header에 맞게 active 기능 부여하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scroll시 각 header에 맞게 Active 기능 부여하기</h2>\n<p>Scroll시 각 Header에 맞게 Active하는 기능을 어떻게 구현해야 하는지를 고민해봤을때, 저는 Scroll값과 offsetTop값을 활용하여 처리하는 것으로 구상했습니다.</p>\n<p><code class=\"language-text\">InterSectionObserver</code> API를 활용하는 것이 물론 퍼포먼스적으로 좋다는 지표도 있지만, 우선 아직 저의 무지함으로 인해.. 구상부터 잘 이루어지지 않았습니다🙁.. Learning Curve가 있기에 좀 더 익숙해지면 해당 방법으로 마이그레이션을 고려할 수 있을것 같습니다.</p>\n<p>따라서 제가 생각한 방법은 Scroll값에 따라 headings 배열을 돌면서 일정 offsetTop 값에 도달하면 Index 값을 참조하여 active 할 수 있는 방법은 어떨까? 로 구상했고 이 방법으로 구현에 진행할 수 있었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// PostTOC.tsx</span>\r\n<span class=\"token keyword\">const</span> calcActive <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isBrowser<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">return</span> <span class=\"token number\">0</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">const</span> offsets<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\r\n\r\n    <span class=\"token comment\">// bring each headings offsetTop</span>\r\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> slug <span class=\"token punctuation\">}</span> <span class=\"token keyword\">of</span> headers<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span>slug<span class=\"token punctuation\">)</span>\r\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>element<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span>\r\n      <span class=\"token punctuation\">}</span>\r\n      offsets<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">.</span>offsetTop <span class=\"token operator\">-</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">const</span> maxIndex <span class=\"token operator\">=</span> offsets<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span>\r\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> scrollY <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> window\r\n    <span class=\"token keyword\">let</span> index <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\r\n\r\n    <span class=\"token comment\">// Scroll Active Trigger (looping the offset)</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>scrollY <span class=\"token operator\">===</span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span> scrollY <span class=\"token operator\">&lt;=</span> offsets<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      index <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\r\n      window<span class=\"token punctuation\">.</span>innerHeight <span class=\"token operator\">+</span> scrollY <span class=\"token operator\">>=</span> document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>scrollHeight <span class=\"token operator\">||</span>\r\n      scrollY <span class=\"token operator\">>=</span> offsets<span class=\"token punctuation\">[</span>maxIndex<span class=\"token punctuation\">]</span>\r\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      index <span class=\"token operator\">=</span> maxIndex\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n      index <span class=\"token operator\">=</span> <span class=\"token function\">findIndex</span><span class=\"token punctuation\">(</span>offsets<span class=\"token punctuation\">,</span> offset <span class=\"token operator\">=></span> offset <span class=\"token operator\">>=</span> scrollY<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">return</span> index\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>headers<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">headers</code> 배열을 참조하여 value를 slug화 한 각각의 태그를 <code class=\"language-text\">element</code>로 불러오고, 각각의 offsetTop 값을 <code class=\"language-text\">offsets</code> 배열에 담습니다. 다시 말하면 <code class=\"language-text\">offsets</code> 배열은 document 기준의 각 header들의 위치를 의미합니다.</p>\n<p>그리고 스크롤 할때마다 Y축의 값을 반환하는 <code class=\"language-text\">scrollY</code> 를 통해서, 3가지 상황으로 조건문을 분기할 수 있습니다. (사실 글보단 코드가 더 이해가 잘 될것 같긴 합니다😅)</p>\n<ol>\n<li>\n<p>만약 <code class=\"language-text\">scrollY</code> 값이 0(맨위) 또는 <code class=\"language-text\">offsets[0]</code>(가장 첫번째 header 문구) 보다 작거나(닿기직전) 해당 위치에 도달 했다면? : <strong>index = 0으로 부여</strong></p>\n</li>\n<li>\n<p><code class=\"language-text\">scrollY</code> 값이 <code class=\"language-text\">offset[maxIndex]</code>보다 크거나 같을때(마지막 header문구 위치와 같거나 지나쳤을때) 또는 window의 innerHeight와 <code class=\"language-text\">scrollY</code> 를 합친 값이 document 기준의 scrollHeight보다 크거나 같을때(마지막 header문구를 지나친건 아니지만, ScrollHeight(스크롤하지 않았을때 전체 높이)를 넘겼을때) : <strong>index = maxIndex로 부여</strong></p>\n</li>\n<li>\n<p>1,2에 해당하지 않을때</p>\n</li>\n</ol>\n<p>그래서 이 <code class=\"language-text\">index</code>를 활용해서 event를 trigger합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// PostTOC.tsx</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>currentIndex<span class=\"token punctuation\">,</span> setCurrentIndex<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\n\r\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">setCurrentIndex</span><span class=\"token punctuation\">(</span><span class=\"token function\">calcActive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">const</span> onScrollForActive <span class=\"token operator\">=</span> <span class=\"token function\">throttle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCurrentIndex</span><span class=\"token punctuation\">(</span><span class=\"token function\">calcActive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span>\r\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scroll'</span><span class=\"token punctuation\">,</span> onScrollForActive<span class=\"token punctuation\">)</span>\r\n\r\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      onScrollForActive<span class=\"token punctuation\">.</span><span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n      window<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scroll'</span><span class=\"token punctuation\">,</span> onScrollForActive<span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>calcActive<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">useEffect()</code> Hook을 활용하여 <code class=\"language-text\">calcActive</code>에 따라 event가 Trigger될 수 있도록 dependency Array에 할당합니다.</p>\n<p>이때 Scroll시, 매번 offsetTop 값과 ScrollY값을 연산해야 하기 때문에 싱글 스레드에 조금이라도 최적화 하는 작업이 필요합니다. 왜냐하면 Scroll시, 매번 연산하기 때문에 console을 찍어보면 값들이 무수히 찍히기 때문입니다.</p>\n<p>따라서 저는 <a href=\"https://www.npmjs.com/package/@types/lodash-es\" target=\"_blank\" rel=\"nofollow\">lodash-es</a>에서 제공하는 <code class=\"language-text\">throttle()</code> 메소드를 활용하여 Scroll Event를 최적화 했습니다. 이는 Scroll시 매번 요청되는 call을 <code class=\"language-text\">SetTimeOut()</code> 연산과 같은 구조로, 300ms를 기다렸다가 <code class=\"language-text\">onScrollForActive</code>를 요청합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// PostTOC.tsx</span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ol</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\r\n</span><span class=\"token punctuation\">{</span>headers<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> value<span class=\"token punctuation\">,</span> depth <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> idx<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\r\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span>\r\n    <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>idx<span class=\"token punctuation\">}</span></span>\r\n    <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> paddingLeft<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>depth <span class=\"token operator\">*</span> <span class=\"token number\">11</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\r\n    <span class=\"token attr-name\">className</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>currentIndex <span class=\"token operator\">===</span> idx <span class=\"token operator\">?</span> <span class=\"token string\">'active'</span> <span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">}</span></span>\r\n    <span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\r\n\t\t// ...\r\n\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\r\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\r\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ol</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><code class=\"language-text\">calcActive()</code> 함수의 리턴 index가 <code class=\"language-text\">useState</code> Hook의 현재 state로 담기는 <code class=\"language-text\">currentIndex</code>에 담기면서, 실제 ol 태그내에서 headers 배열(<code class=\"language-text\">PostTOC</code> 컴포넌트 상단에서 <code class=\"language-text\">useMemo()</code>를 통해 연산한 값을 재사용 했습니다.) 을 도는 idx 값과 비교하게 되면서 <code class=\"language-text\">currentIndex</code>와 일치하는 idx에 대해서만 active 활성화를 부여하게 되면, Scroll시 bold체로 활성화 되는 것을 볼 수 있습니다.</p>\n<p>(*<code class=\"language-text\">li</code>태그 에서 style은 indentation을 주기 위해서 depth를 활용한 것입니다.)</p>\n<h2 id=\"header에-맞는-href로-이동하기\" style=\"position:relative;\"><a href=\"#header%EC%97%90-%EB%A7%9E%EB%8A%94-href%EB%A1%9C-%EC%9D%B4%EB%8F%99%ED%95%98%EA%B8%B0\" aria-label=\"header에 맞는 href로 이동하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>header에 맞는 href로 이동하기</h2>\n<p>그리고 <code class=\"language-text\">a</code> 태그에 href 값으로 <code class=\"language-text\">slug(value)</code>를 할당하게 되면 헤더에 맞는 위치로 이동하게 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// PostTOC.tsx</span>\r\n<span class=\"token comment\">//...</span>\r\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">data-idx</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>idx<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">href</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">#</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">slug</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\r\n\t</span><span class=\"token punctuation\">{</span>value<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\r\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token comment\">//...</span></code></pre></div>\n<h3 id=\"-issue-handle\" style=\"position:relative;\"><a href=\"#-issue-handle\" aria-label=\" issue handle permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🪓 Issue Handle</h3>\n<p><img src=\"https://github.com/dobyming/dobyming.github.io/assets/90133704/d9c2b8db-6934-4e50-9e93-bc0d5eb196f3\" alt=\"2023-05-16 11;09;11\"></p>\n<p>Testing을 하던 중, console에 이런 error log가 찍혔습니다. 공통점을 보니, 숫자로 시작하는 헤더를 <code class=\"language-text\">querySelector</code>가 parsing을 수행할 수 없다는 류의 에러였습니다. (TOC 컨테이너에 해당하는 헤더값을 클릭 시, 해당하는 헤더로 이동하지도 않았습니다.)</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> heading <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">querySelector</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>HTMLHeadingElement<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>href<span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>heading<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token keyword\">return</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\nwindow<span class=\"token punctuation\">.</span><span class=\"token function\">scrollTo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n\ttop<span class=\"token operator\">:</span> heading<span class=\"token punctuation\">.</span>offsetTop<span class=\"token punctuation\">,</span>\r\n  behavior<span class=\"token operator\">:</span> <span class=\"token string\">'smooth'</span><span class=\"token punctuation\">,</span>\r\n <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>문제가 발생한 코드였고 <a href=\"https://stackoverflow.com/questions/37270787/uncaught-syntaxerror-failed-to-execute-queryselector-on-document\" target=\"_blank\" rel=\"nofollow\">StackOverflow</a>에서 보니, <code class=\"language-text\">querySelctor</code>는 숫자로 시작하는 heading은 인식하지 못한다는 것이었습니다. 따라서 위의 코드는 과감히 제거하고, <code class=\"language-text\">a</code> 태그의 <code class=\"language-text\">href</code>에 slug화 한 value를 할당하여 숫자로 시작하는 slug도 인식할 수 있도록 트러블 슈팅을 진행했습니다.</p>\n<h2 id=\"-후기\" style=\"position:relative;\"><a href=\"#-%ED%9B%84%EA%B8%B0\" aria-label=\" 후기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🔮 후기</h2>\n<p>일주일 가까이? 시간을 쏟고 나름 고생하면서 만들었네요.. 기능 개발에서 많은 고민과 시간을 투자해서 그런지 더 소중하게 다가옵니다. 의외로 CSS 스타일링도 내가 아는게 다 아니었구나를 또 깨달으며 역시 계속 배워야 한다는 것을 깨달았던 feature 개발이었습니다.</p>\n<p>성능상 최적화해야 할 부분이 남은 숙제겠네요! 그래도 스스로 TOC 기능을 만든건 꽤나 뿌듯합니다.😊</p>","headings":[{"depth":2,"value":"💭 동기"},{"depth":2,"value":"결과"},{"depth":2,"value":"header를 어떻게 갖고 올것인가?"},{"depth":2,"value":"Value를 어떻게 slug화 할것인가?"},{"depth":2,"value":"Data 흐름은?"},{"depth":2,"value":"TOC 컴포넌트 Styling"},{"depth":2,"value":"Scroll시 각 header에 맞게 Active 기능 부여하기"},{"depth":2,"value":"header에 맞는 href로 이동하기"},{"depth":3,"value":"🪓 Issue Handle"},{"depth":2,"value":"🔮 후기"}],"frontmatter":{"title":"Gatsby 블로그 - TOC 기능 구현하기","summary":"포스팅을 읽다보면, 다시 읽고 싶은 부분으로 돌아가고 싶었던 경험이 있을겁니다. 이때 일일이 스크롤해서 내가 원하는 컨텐츠를 읽는것은 사용자 경험이 굉장히 떨어지는 행위입니다.","date":"2023.05.16.","categories":["Web","Gatsby"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAUEBgcJ/8QAFQEBAQAAAAAAAAAAAAAAAAAAAgT/2gAMAwEAAhADEAAAAevkXeWNDrY/Jx//xAAdEAACAgEFAAAAAAAAAAAAAAACBAEFBgADBxMX/9oACAEBAAEFAh5ATnKPUsR6aq3r7tSFFRZ0ABtx/8QAGxEAAgIDAQAAAAAAAAAAAAAAAQIREhBBUWH/2gAIAQMBAT8Bcoa0UpCgNLWltt5PMf/EAB0RAAICAgMBAAAAAAAAAAAAAAEDAhEEEgAUISL/2gAIAQIBAT8ByJ48yvrpkgRTCLBJhZu4Xu0EgaiXnwPBViroc//EACUQAAMBAAEDAgcBAAAAAAAAAAECAwQRBRITFCEABhAkMTI0Qv/aAAgBAQAGPwLT8tP0vqa+njsqOoiLUjU4J6aaESKIaNx6Swn4zWlGfL2y+4HZWj6di0zwve8Bg0aDNY28IX1eQaOmVOh/5XhurG36rXvIUjd0y50ZDSshUw0QBpFvHZQumUXPioGlQheFslJE+SdFV9i5s666IJ01CMxpeY44m9wvkZBwOFLFRwPb2+nbNFRe534RQo76OaUbgf6ejM7n8s7FjySfj//EABkQAQEBAQEBAAAAAAAAAAAAAAERACEQQf/aAAgBAQABPyEjLEp4QJKiIJgcahYFuOLisO8zbbmtGtSJvbXOKdedB8/cQjxSjIZ1SIMXanWf/9oADAMBAAIAAwAAABAgD//EABcRAQEBAQAAAAAAAAAAAAAAAAERIQD/2gAIAQMBAT8QfjBiI7JQjGMJSWHf/8QAGBEBAAMBAAAAAAAAAAAAAAAAARARITH/2gAIAQIBAT8QZ3Jzl6iWmkgMf//EABgQAQEAAwAAAAAAAAAAAAAAAAEAEDGB/9oACAEBAAE/EFOLxCvRNqYKNnjKSiOytuICJmn100DgI1PLXTpXSj4MZMA/AHvsNU2l/9k="},"images":{"fallback":{"src":"/static/0e6a2859511bc04abeba878c5508a73f/f77da/gatsby.webp","srcSet":"/static/0e6a2859511bc04abeba878c5508a73f/dd2c8/gatsby.webp 375w,\n/static/0e6a2859511bc04abeba878c5508a73f/c5e11/gatsby.webp 750w,\n/static/0e6a2859511bc04abeba878c5508a73f/f77da/gatsby.webp 1500w","sizes":"(min-width: 1500px) 1500px, 100vw"},"sources":[]},"width":1500,"height":1000}},"publicURL":"/static/0e6a2859511bc04abeba878c5508a73f/gatsby.jpg"}}}}]}},"pageContext":{"slug":"/Develop/Gatsby-TOC-구현하기/","prev":{"node":{"fields":{"slug":"/Develop/Gatsby-다크모드-구현기/"},"headings":[{"depth":2,"value":"동기"},{"depth":2,"value":"Theme을 어떻게 전달할 것인가 : ThemeProvider VS CSS Variable"},{"depth":3,"value":"🤔 emotion의 ThemeProvider로 삽질"},{"depth":3,"value":"🥰 CSS Variable로 광명을 찾다"},{"depth":2,"value":"Flicker Issue 에러 해결하기"},{"depth":2,"value":"🔮 Utterance에 다크모드 적용하기"},{"depth":3,"value":"결과물"},{"depth":2,"value":"마무리"},{"depth":3,"value":"🙇🏼‍♀️ 참고"}]}},"next":{"node":{"fields":{"slug":"/Develop/Gastby-이전글-다음글-구현/"},"headings":[{"depth":2,"value":"동기"},{"depth":2,"value":"결과"},{"depth":2,"value":"gatsby-node.js 파일 수정"},{"depth":2,"value":"이전글/다음글 컴포넌트 설계하기"},{"depth":2,"value":"post_template 에서 slug 조작하기"},{"depth":2,"value":"맺음말"}]}}}},"staticQueryHashes":["1463137677"],"slicesMap":{}}