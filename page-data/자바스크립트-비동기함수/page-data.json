{"componentChunkName":"component---src-templates-post-template-tsx","path":"/자바스크립트-비동기함수/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>Promise 객체</h2>\n<p>동기: 콜백 지옥에서 탈출하기</p>\n<p><strong>비동기 작업이 가질 수 있는 3가지 상태</strong></p>\n<p><img src=\"https://joshua1988.github.io/images/posts/web/javascript/promise.svg\" alt=\"https://joshua1988.github.io/images/posts/web/javascript/promise.svg\"></p>\n<ul>\n<li>Pending: 대기상태 (성공 or 실패)</li>\n<li>Fulfilled: 성공 (Pending 상태에서 resolve 됐다)</li>\n<li>Rejected: 실패 (Pending 상태에서 rejecet 됐다)</li>\n</ul>\n<h4>Promise 객체를 활용한 비동기 구문</h4>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// 기존 비동기 처리 </span>\r\n<span class=\"token keyword\">function</span> <span class=\"token function\">isPositive</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">number<span class=\"token punctuation\">,</span>resolve<span class=\"token punctuation\">,</span>reject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> number <span class=\"token operator\">===</span> <span class=\"token string\">'number'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\t\t\t<span class=\"token comment\">//resolve</span>\r\n\t\t\t<span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>number <span class=\"token operator\">>=</span><span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"양수\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"음수\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n\t\t\t<span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"주어진 값이 숫자형이 아닙니다\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">// Promise 객체를 반환하여 구현한 비동기 코드</span>\r\n<span class=\"token keyword\">function</span> <span class=\"token function\">isPositiveP</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token comment\">//실행자 </span>\r\n\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span>reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> number <span class=\"token operator\">===</span> <span class=\"token string\">'number'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\t\t\t\t<span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>number <span class=\"token operator\">>=</span><span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"양수\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"음수\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n\t\t\t\t<span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"주어진 값이 숫자형이 아닙니다\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token function\">isPostiveP</span><span class=\"token punctuation\">(</span><span class=\"token number\">101</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//101</span>\r\n\r\nres\r\n\t<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> \r\n\t\tconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"작업 성공: \"</span><span class=\"token punctuation\">,</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\r\n\t\t\tconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"작업에러\"</span><span class=\"token punctuation\">)</span>\r\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </code></pre></div>\n<p><code class=\"language-text\">then</code> 과 <code class=\"language-text\">catch</code> 구문을 활용하여 Fulfilled 상태인지 Rejected 상태인지 처리 결과값을 반환 받을 수 있습니다.</p>\n<h2>여러 개의 프로미스 연결하기 (Promise Chaining)</h2>\n<p>프로미스의 또 다른 특징은 <strong>여러 개의 프로미스를 연결</strong>하여 사용할 수 있다는 점입니다. 앞 예제에서 <code class=\"language-text\">then()</code> 메서드를 호출하고 나면 새로운 프로미스 객체가 반환됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">// ...</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">// then() 으로 여러 개의 프로미스를 연결한 형식</span>\r\n<span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">// ...</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">// ...</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">// ...</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>async- await : 직관적인 비동기 처리 코드 작성</h2>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// async 예제</span>\r\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">helloAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token keyword\">return</span> <span class=\"token string\">'hello async'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span> </code></pre></div>\n<p><code class=\"language-text\">helloAsync()</code> 함수 콘솔을 찍으면 <strong>Promise 객체</strong>를 반환하는데 이는 <code class=\"language-text\">async</code> 함수의 특징 중, Promise 객체를 반환하는 특징 때문입니다.</p>\n<p>이때 다음 코드를 출력해보면 ‘hello async’가 정상적으로 콘솔에 출력됩니다. 이는 <code class=\"language-text\">res</code> 콜백함수가 <code class=\"language-text\">helloAsync</code>함수의 return을 바라봤다고 볼 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">helloAsync<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n\tconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// await 예제</span>\r\n<span class=\"token keyword\">function</span> <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">ms</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span>ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">helloAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token keyword\">return</span> <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token keyword\">return</span> <span class=\"token string\">'hello async'</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span> </code></pre></div>\n<p>위 함수를 <strong>async-await 구문</strong>으로 리팩토링하면 아래와 같습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">helloAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token keyword\">await</span> <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token keyword\">return</span> <span class=\"token string\">'hello async'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span> \r\n\r\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">helloAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\tconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span> \r\n<span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 3초 기다렸다가 'hello async' 반환</span></code></pre></div>\n<p>이때 <code class=\"language-text\">await</code> 함수는 동기적으로 수행되기 때문에, await에 선언된 구문을 먼저 수행을 해야 return할 수 있는 구조이다.</p>\n<h4>async-await 구문 정리</h4>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">함수명</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">await</span> <span class=\"token function\">비동기_처리_메서드_명</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>API 호출</h2>\n<p>API : 클라이언트와 서버간 통신할 수 있도록 도와줌 (request and response)</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// &lt;JSON placeholder를 활용한 API 호출 메소드 예제></span>\r\n<span class=\"token keyword\">let</span> response <span class=\"token operator\">=</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Json Placeholder URL...'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> \r\n\tconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이때 <code class=\"language-text\">fetch()</code> 함수에 hover시, <code class=\"language-text\">Promise&lt;Response></code> 로 Promise 객체를 반환함을 알 수 있습니다. 즉 <code class=\"language-text\">fetch()</code> 함수는 <strong>비동기 함수</strong> 임을 의미하고, <code class=\"language-text\">then</code> 키워드도 작성할 수 있습니다.</p>\n<p>이를 이제 async-await 함수를 통해 리팩토링 시, 다음과 같습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">async</span> functiong <span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token keyword\">let</span> rawResponse <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Json URL'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token keyword\">let</span> jsonResponse <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> rawResponse<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\tconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>jsonResponse<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n<span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 객체 배열 반환 </span></code></pre></div>","frontmatter":{"title":"Promise 객체, async-await 함수를 활용한 비동기 처리","summary":"자바스크립트의 비동기 함수 - Promise, async-await","date":"2023.01.26.","categories":["JavaScript"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAABYklEQVR42mP4fl+ObMQwjDV/u4edTVjzz4fy/57J/3wo9+2u3J/Hcv9fyv96BDWCgZBOuTdXZc/vlnx3Tfb/C/n7p6R3rRB/flHmz1P5b/fwav5yV+7/K/kti8SYmRnP75Y8vEFCSICJmZlBXJT53C7Jf8/kCWpW2LRQjIGB4eJeyaRIHhkp5tvHpCe3CN0/Jf37sRyxmi/tleytF2RgYMhN5n14Vub/a/lvd/Fq/nYPpHnDfJDmIxsl/r+Sr8jhZ2NjZGVhXDZN5P8L3M7++VAOFEhvFXauFWdgYDi6SeLlJZn39+X+PJc3M2DT02L79RCbzd8gmh/IOVhxuDlw+rlzcnIw3jshbWfOoa7M0lMnKCnO7GbP+e8pDpu/3ZP7/Vh++TQRY102HXW2+RNE/r9SOLhewtOJU0GWJcCD69ohqb9P8Yb2/1fyvx6Dkse/F/Lf78n9fSH/74UCmKHwGxzPAGOiDkdk0wLIAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/72cbf5a18fefc590eeb1cc3dec648985/b3556/jsicon.png","srcSet":"/static/72cbf5a18fefc590eeb1cc3dec648985/2bbe4/jsicon.png 120w,\n/static/72cbf5a18fefc590eeb1cc3dec648985/dddb8/jsicon.png 240w,\n/static/72cbf5a18fefc590eeb1cc3dec648985/b3556/jsicon.png 480w","sizes":"(min-width: 480px) 480px, 100vw"},"sources":[{"srcSet":"/static/72cbf5a18fefc590eeb1cc3dec648985/f9f5f/jsicon.webp 120w,\n/static/72cbf5a18fefc590eeb1cc3dec648985/4b558/jsicon.webp 240w,\n/static/72cbf5a18fefc590eeb1cc3dec648985/b8574/jsicon.webp 480w","type":"image/webp","sizes":"(min-width: 480px) 480px, 100vw"}]},"width":480,"height":360}},"publicURL":"/static/72cbf5a18fefc590eeb1cc3dec648985/jsicon.png"}}}}]}},"pageContext":{"slug":"/자바스크립트-비동기함수/","prev":{"node":{"fields":{"slug":"/Redux-Toolkit/"}}},"next":{"node":{"fields":{"slug":"/create-react-app/"}}}}},"staticQueryHashes":[],"slicesMap":{}}