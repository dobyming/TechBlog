{"componentChunkName":"component---src-templates-post-template-tsx","path":"/posts/Gatsby-Search/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2 id=\"동기\" style=\"position:relative;\"><a href=\"#%EB%8F%99%EA%B8%B0\" aria-label=\"동기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>동기</h2>\n<p>동기라고 거창하게 써놨지만 별거 없습니다. 앞으로 이 블로그를 평생 쓸 예정인데.. 그럼 지금보다 포스팅 수도 더 많아질거고. 그러면 내가 일일이 무한 스크롤로 내려서 글을 찾는 행위 자체가 굉장히 불편한데?</p>\n<p>정말 이 사고의 흐름대로 생각했고 이 고민에 대한 결론은 “그래. 검색 기능을 만들어보자!” 로 귀결됐습니다.</p>\n<h2 id=\"결과-화면\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EA%B3%BC-%ED%99%94%EB%A9%B4\" aria-label=\"결과 화면 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결과 화면</h2>\n<p><img src=\"https://velog.velcdn.com/images/damin1025/post/515c2fd7-c31e-4497-81c5-65f39ba31a30/image.gif\" alt=\"\">\r\n결과 화면은 위와 같이 검색 아이콘을 클릭 후 검색 페이지로 이동하여 keyword를 검색하면 아래에 관련 포스팅이 나열되고 그리고 원하는 포스팅으로 이동하는 방식으로 구현에 진행했습니다.</p>\n<h2 id=\"어떤-기술을-선택할-것인가\" style=\"position:relative;\"><a href=\"#%EC%96%B4%EB%96%A4-%EA%B8%B0%EC%88%A0%EC%9D%84-%EC%84%A0%ED%83%9D%ED%95%A0-%EA%B2%83%EC%9D%B8%EA%B0%80\" aria-label=\"어떤 기술을 선택할 것인가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>어떤 기술을 선택할 것인가</h2>\n<p><a href=\"https://www.gatsbyjs.com/docs/how-to/adding-common-features/adding-search/\" target=\"_blank\" rel=\"nofollow\">공식 docs</a>를 보면 gatsby에 검색을 구현하는 방법을 크게 2가지로 소개하고 있습니다.</p>\n<p>첫 번째 방법은 <strong>클라이언트 측 검색</strong>입니다. 빌드 또는 런타임에 데이터를 인덱싱하고 이를 이용해 로컬에서 검색을 수행하는 방법입니다. 공식 docs에서는 <code class=\"language-text\">js-search</code>, <code class=\"language-text\">gatsby-plugin-elasticlunr-search</code>, <code class=\"language-text\">gatsby-plugin-local-search</code> 를 제시하고 있습니다.</p>\n<p>두 번째 방법은 <strong>API기반 검색엔진</strong>을 활용하는 방법으로 외부 서비스를 활용하는 방식입니다. 빌드 시점에 검색 대상 데이터들을 인덱싱해 외부 서비스에 올려두고 런타임에는 API로 검색합니다.</p>\n<p>하지만 API기반 검색엔진 사용 시 블로그의 빌드 배포 프로세스에 인덱스를 전송해야하고 사용 시 비용이 발생하거나 그리고 무료인 경우 횟수에 제약이 있어 굳이 사용해야 할 이유는 찾지 못했고, 클라이언트 측 검색 방법이 블로그에 부담이 덜 갈것 같은 방식이라고 생각하여 저는 첫번째 방법으로 아이디어를 scheme했습니다.</p>\n<h2 id=\"검색-관련-라이브러리\" style=\"position:relative;\"><a href=\"#%EA%B2%80%EC%83%89-%EA%B4%80%EB%A0%A8-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC\" aria-label=\"검색 관련 라이브러리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>검색 관련 라이브러리</h2>\n<p>여러 Gatsby Starter에 구현된 검색 기능을 참고해봤을때, GraphQL에서 요청한 edges를 모두 돌아 값을 불러오고, 그리고 그 값을 돌면서 search하는 방식으로 구현된 방식이 많았습니다. 하지만 search 시, 모든 배열의 사이즈에 depend하기 때문에 <code class=\"language-text\">O(N) time</code>이 소요되는 것을 생각하면 추후 포스팅 양이 많아지게 될때 검색 속도 저하를 야기할 수 있습니다. 따라서 검색 라이브러리를 활용하는 것이 시간 복잡도면에서 나을것 같다는 판단이 들었습니다.</p>\n<p>검색 라이브러리로 구현 시, 아래와 같은 기능을 제공합니다.</p>\n<ul>\n<li>인덱싱으로 빠른 검색</li>\n<li>검색하려는 콘텐츠(제목 혹은 본문)에 더 가중치를 둘 수 있다</li>\n<li>검색어 하이라이팅 기능</li>\n<li>검색에 and, or과 같은 논리 연산 적용 가능</li>\n</ul>\n<p>그럼 어떤 라이브러리로 이를 실현할 수 있을까 고민을 하던 중에 <a href=\"https://velog.io/@seyoung8239/Gatsby-%EB%B8%94%EB%A1%9C%EA%B7%B8-%EA%B2%80%EC%83%89%EA%B8%B0%EB%8A%A5-%EB%8F%84%EC%9E%85%ED%95%98%EA%B8%B0\" target=\"_blank\" rel=\"nofollow\">해당 블로그</a>에서 아이디어를 얻어갈 수 있었습니다.</p>\n<p><code class=\"language-text\">flexsearch</code> 나 <code class=\"language-text\">lunr</code> 같은 경우는 한글 검색어 이슈가 있고(영문에 특화) <code class=\"language-text\">js-search</code>는 그 생태계가 아직 좁았기에 <code class=\"language-text\">fuse.js</code> 방식을 선택했습니다.</p>\n<h2 id=\"fusejs-검색\" style=\"position:relative;\"><a href=\"#fusejs-%EA%B2%80%EC%83%89\" aria-label=\"fusejs 검색 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fuse.js 검색</h2>\n<p><a href=\"https://fusejs.io/\" target=\"_blank\" rel=\"nofollow\">fuse.js</a>는 fuzzy하게 search한다에서 착안됐습니다. 여기서 fuzzy란 <strong>대략적으로 검색</strong>한다의 의미를 지니고 있습니다.</p>\n<p>가장 큰 장점은 백엔드의 지원이 필요 없고, 다른 라이브러리에 dependency를 갖고 있지 않으며 결정적으로 <strong>클라이언트 측 검색</strong>기반이라는 것이었습니다.</p>\n<h3 id=\"gatsby에서-fusejs-사용하기\" style=\"position:relative;\"><a href=\"#gatsby%EC%97%90%EC%84%9C-fusejs-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-label=\"gatsby에서 fusejs 사용하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gatsby에서 fuse.js 사용하기</h3>\n<p>Gatsby 빌드 과정에서 목록을 인덱싱하여 어딘가 저장해두어야 하고 이렇게 생성된 데이터는 블로그의 런타임에 fuse.js 인스턴스를 생성하여 사용하도록 구성해야 합니다.</p>\n<p>이때 빌드 과정은 플러그인을 활용하면 되고 런타임 검색은 hook을 활용하면 됩니다.</p>\n<h3 id=\"gatsby-plugin-fusejs\" style=\"position:relative;\"><a href=\"#gatsby-plugin-fusejs\" aria-label=\"gatsby plugin fusejs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>gatsby-plugin-fusejs</h3>\n<p><a href=\"gatsby-plugin-fusejs\">gatsby-plugin-fusejs</a> 해당 docs의 npm 명령어를 follow하여 설치를 진행 후, config를 설정합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// gatsby-config.js</span>\r\n\t<span class=\"token punctuation\">{</span>\r\n      <span class=\"token literal-property property\">resolve</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-plugin-fusejs</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// 인덱스를 만들고자 하는 데이터의 쿼리</span>\r\n        <span class=\"token literal-property property\">query</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\r\n          {\r\n            allMarkdownRemark {\r\n              nodes {\r\n                id\r\n                rawMarkdownBody\r\n                fields {\r\n                  slug\r\n                }\r\n                frontmatter {\r\n                  title\r\n                }\r\n              }\r\n            }\r\n          }\r\n        </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token comment\">// 인덱스를 만들고자 하는 데이터의 프로퍼티</span>\r\n        <span class=\"token literal-property property\">keys</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'body'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token comment\">// graphql의 결과물을 단순 객체 배열로 변환하는 함수</span>\r\n        <span class=\"token function-variable function\">normalizer</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> data <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\r\n          data<span class=\"token punctuation\">.</span>allMarkdownRemark<span class=\"token punctuation\">.</span>nodes<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">node</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n            <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> node<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span>\r\n            <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>slug<span class=\"token punctuation\">,</span>\r\n            <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">,</span>\r\n            <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> node<span class=\"token punctuation\">.</span>rawMarkdownBody<span class=\"token punctuation\">,</span>\r\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>설치 후 gatsby-config.js에 인덱스로 만들어지기 원하는 데이터의 쿼리, 데이터 중에서도 검색이 되었으면 하는 프로퍼티, GraphQL 결과물을 객체 배열로 변환하기 위한 함수를 옵션으로 전달합니다.</p>\n<p><img src=\"https://velog.velcdn.com/images/damin1025/post/4ad55151-b71b-474f-bb50-aea87c69e6d3/image.PNG\" alt=\"\"></p>\n<p>GraphQL 사이트에 접속 시, <code class=\"language-text\">allFusejs</code> 필드가 추가 됨을 확인할 수 있습니다.</p>\n<h3 id=\"react-use-fusejs\" style=\"position:relative;\"><a href=\"#react-use-fusejs\" aria-label=\"react use fusejs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>react-use-fusejs</h3>\n<p>다음으론 만들어진 인덱스를 활용하기 위해 런타임에 hook을 활용하여 검색을 수행해야 합니다.</p>\n<p>이때 매번 검색어를 입력 시, 인덱스를 parsing 후 인스턴스를 생성하게 되면 추후 포스팅의 양이 많아질때 자원이 낭비됩니다. (Props Drilling)\r\n따라서 이를 방지하기 위해서 index 페이지를 처음 Search 페이지를 클릭 했을때 모두 다운받고 그리고 그 다운받은 data들을 context에 담아 재사용할 수 있도록 유도하는 것이 더 효율적일것입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">/* Search.tsx */</span>\r\n\r\n  <span class=\"token comment\">// index.js(최상위)로부터 다운 후 파싱하여 검색을 수행</span>\r\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useStaticQuery</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>SearchProps<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\r\n    {\r\n      fusejs {\r\n        publicUrl\r\n      }\r\n    }\r\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\r\n\r\n  <span class=\"token comment\">/**\r\n   * 1. Get User Search Input value\r\n   * 2. Collect all Index data and store in context\r\n   * 3. Based on fuseData find query data with fuzzy search\r\n   * 4. Lazy Loading (when Post's amount is getting larger)\r\n   */</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>query<span class=\"token punctuation\">,</span> setQuery<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> fuseData<span class=\"token punctuation\">,</span> setFuseData <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>AppContext<span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useGatsbyPluginFusejs</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>SearchItem<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">,</span> fuseData<span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isFetching<span class=\"token punctuation\">,</span> setIsFetching<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\r\n\r\n  <span class=\"token keyword\">const</span> fetching <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>fetching<span class=\"token punctuation\">.</span>current <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>fuseData <span class=\"token operator\">&amp;&amp;</span> query<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      fetching<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\r\n\r\n      <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>fusejs<span class=\"token punctuation\">.</span>publicUrl<span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>res <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>data <span class=\"token operator\">=></span> <span class=\"token function\">setFuseData</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">.</span><span class=\"token function\">finally</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setIsFetching</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>fuseData<span class=\"token punctuation\">,</span> query<span class=\"token punctuation\">,</span> setFuseData<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>인덱스를 재사용하기 위해서 context에 담을 것이고, 이는 최상위 컴포넌트에서 구현해줘야 합니다. 따라서 <code class=\"language-text\">context</code> 폴더를 새로 생성하고, <code class=\"language-text\">app.tsx</code> 파일을 새로 만들어서 아래와 같이 context를 App ➡ Search로 data를 위임할 수 있도록 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">/* app.tsx */</span>\r\n\r\n<span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n  createContext<span class=\"token punctuation\">,</span>\r\n  SetStateAction<span class=\"token punctuation\">,</span>\r\n  useState<span class=\"token punctuation\">,</span>\r\n  ReactNode<span class=\"token punctuation\">,</span>\r\n  FunctionComponent<span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Dispatch <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\r\n\r\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">AppContext</span> <span class=\"token punctuation\">{</span>\r\n  fuseData<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span>\r\n  setFuseData<span class=\"token operator\">:</span> Dispatch<span class=\"token operator\">&lt;</span>SetStateAction<span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">>></span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> AppContext <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">createContext</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>AppContext<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n  fuseData<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token function-variable function\">setFuseData</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">AppProps</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n  children<span class=\"token operator\">:</span> ReactNode\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token comment\">// Provide Props to Search</span>\r\n<span class=\"token keyword\">const</span> AppProvider<span class=\"token operator\">:</span> FunctionComponent<span class=\"token operator\">&lt;</span>AppProps<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> children <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>fuseData<span class=\"token punctuation\">,</span> setFuseData<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AppContext.Provider</span></span> <span class=\"token attr-name\">value</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> fuseData<span class=\"token punctuation\">,</span> setFuseData <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\r\n      </span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\r\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">AppContext.Provider</span></span><span class=\"token punctuation\">></span></span>\r\n  <span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> AppProvider</code></pre></div>\n<p>이때 Provider에 value를 담을때 객체로 한번 더 감싸서 보내주는 이유는 data의(state) 값이 변경될때 setFuseData는 재생성되지 않지만, fuseData가 재생성되지 않도록 하기 위해 감싸서 보냅니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// gatsby-browser.js</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AppProvider <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./src/context/app'</span>\r\n \r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">wrapRootElement</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> element <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>AppProvider<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>element<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>AppProvider<span class=\"token operator\">></span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위와 같이 코드를 모두 구성 시, React-Developer-Tools를 확인하면 Context에 post 정보들이 담겨있는것을 확인할 수 있습니다. 그렇기 때문에 검색어를 입력 시, 해당 값들은 이미 담겨있어 자원의 낭비를 최소화 할 수 있습니다.\r\n<img src=\"https://velog.velcdn.com/images/damin1025/post/3258df66-245c-4b99-84aa-6f0d09f7371e/image.PNG\" alt=\"\"></p>\n<h2 id=\"배포-후-성능-check\" style=\"position:relative;\"><a href=\"#%EB%B0%B0%ED%8F%AC-%ED%9B%84-%EC%84%B1%EB%8A%A5-check\" aria-label=\"배포 후 성능 check permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>배포 후 성능 check</h2>\n<p><img src=\"https://velog.velcdn.com/images/damin1025/post/56f43f3a-a80b-42e2-8091-35326e624444/image.PNG\" alt=\"\"></p>\n<p>검색 기능 추가 후, lightHouse 점수를 확인해본 결과 퍼포에서 1점 깎인것 빼곤 모두 100을 유지했다..!!</p>","headings":[{"depth":2,"value":"동기"},{"depth":2,"value":"결과 화면"},{"depth":2,"value":"어떤 기술을 선택할 것인가"},{"depth":2,"value":"검색 관련 라이브러리"},{"depth":2,"value":"fuse.js 검색"},{"depth":3,"value":"Gatsby에서 fuse.js 사용하기"},{"depth":3,"value":"gatsby-plugin-fusejs"},{"depth":3,"value":"react-use-fusejs"},{"depth":2,"value":"배포 후 성능 check"}],"frontmatter":{"title":"Gatsby 블로그 - 검색기능 구현하기🔎","summary":"이번 포스팅에선 Gatsby 블로그에 검색 기능을 추가하는 방법에 대해서 적어보려고 합니다.","date":"2023.06.08.","categories":["Web","Gatsby"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAUEBgcJ/8QAFQEBAQAAAAAAAAAAAAAAAAAAAgT/2gAMAwEAAhADEAAAAevkXeWNDrY/Jx//xAAdEAACAgEFAAAAAAAAAAAAAAACBAEFBgADBxMX/9oACAEBAAEFAh5ATnKPUsR6aq3r7tSFFRZ0ABtx/8QAGxEAAgIDAQAAAAAAAAAAAAAAAQIREhBBUWH/2gAIAQMBAT8Bcoa0UpCgNLWltt5PMf/EAB0RAAICAgMBAAAAAAAAAAAAAAEDAhEEEgAUISL/2gAIAQIBAT8ByJ48yvrpkgRTCLBJhZu4Xu0EgaiXnwPBViroc//EACUQAAMBAAEDAgcBAAAAAAAAAAECAwQRBRITFCEABhAkMTI0Qv/aAAgBAQAGPwLT8tP0vqa+njsqOoiLUjU4J6aaESKIaNx6Swn4zWlGfL2y+4HZWj6di0zwve8Bg0aDNY28IX1eQaOmVOh/5XhurG36rXvIUjd0y50ZDSshUw0QBpFvHZQumUXPioGlQheFslJE+SdFV9i5s666IJ01CMxpeY44m9wvkZBwOFLFRwPb2+nbNFRe534RQo76OaUbgf6ejM7n8s7FjySfj//EABkQAQEBAQEBAAAAAAAAAAAAAAERACEQQf/aAAgBAQABPyEjLEp4QJKiIJgcahYFuOLisO8zbbmtGtSJvbXOKdedB8/cQjxSjIZ1SIMXanWf/9oADAMBAAIAAwAAABAgD//EABcRAQEBAQAAAAAAAAAAAAAAAAERIQD/2gAIAQMBAT8QfjBiI7JQjGMJSWHf/8QAGBEBAAMBAAAAAAAAAAAAAAAAARARITH/2gAIAQIBAT8QZ3Jzl6iWmkgMf//EABgQAQEAAwAAAAAAAAAAAAAAAAEAEDGB/9oACAEBAAE/EFOLxCvRNqYKNnjKSiOytuICJmn100DgI1PLXTpXSj4MZMA/AHvsNU2l/9k="},"images":{"fallback":{"src":"/static/0e6a2859511bc04abeba878c5508a73f/f77da/gatsby.webp","srcSet":"/static/0e6a2859511bc04abeba878c5508a73f/dd2c8/gatsby.webp 375w,\n/static/0e6a2859511bc04abeba878c5508a73f/c5e11/gatsby.webp 750w,\n/static/0e6a2859511bc04abeba878c5508a73f/f77da/gatsby.webp 1500w","sizes":"(min-width: 1500px) 1500px, 100vw"},"sources":[]},"width":1500,"height":1000}},"publicURL":"/static/0e6a2859511bc04abeba878c5508a73f/gatsby.jpg"}}}}]}},"pageContext":{"slug":"/posts/Gatsby-Search/","prev":null,"next":{"node":{"fields":{"slug":"/posts/Gatsby-Trouble-Shooting/"},"headings":[{"depth":2,"value":"#418 #423 Minified Error"},{"depth":3,"value":"해결"},{"depth":2,"value":"SVG Icon Flicker Issue"},{"depth":3,"value":"useEffect와 useLayoutEffect 적절히 사용하기"},{"depth":4,"value":"useEffect"},{"depth":4,"value":"useLayoutEffect"},{"depth":3,"value":"gatsby-plugin-offline 활용하기"},{"depth":3,"value":"결과물"},{"depth":2,"value":"Ongoing.."},{"depth":3,"value":"+) 23.05.29 LightHouse 점수 💯"},{"depth":3,"value":"🙇🏼‍♀️참고"}]}}}},"staticQueryHashes":["1463137677"],"slicesMap":{}}