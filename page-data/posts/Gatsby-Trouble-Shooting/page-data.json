{"componentChunkName":"component---src-templates-post-template-tsx","path":"/posts/Gatsby-Trouble-Shooting/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p><code class=\"language-text\">Gastby</code> 프레임워크를 활용하여 블로그를 구현하고 운영한지 어느덧 2달이 다 되가고 있네요.. 다양한 기능들을 블로그에 하나씩 덧붙혀가면서 동시에 에러도 같이 늘어났었는데요 😅</p>\n<p>이 기간동안 제가 접한 Issue들과 어떻게 해결하려고 노력했는지를 여러분께 공유하려고 해요.</p>\n<h2 id=\"418-423-minified-error\" style=\"position:relative;\"><a href=\"#418-423-minified-error\" aria-label=\"418 423 minified error permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>#418 #423 Minified Error</h2>\n<p>어느정도 블로그를 구현하고 배포하면서 lightHouse로 Performance 점수를 측정하는데 Best Practices 부문에서 자꾸 92점이라는 Score가 찍혀있었고, 해당 원인으로는 Console log에 에러가 찍히는데? 라고 알려주더라구요.</p>\n<p><img src=\"https://velog.velcdn.com/images/damin1025/post/f8871c18-0dc4-4b03-be52-0fcf92b7ab65/image.PNG\" alt=\"\"></p>\n<p>LightHouse에서 말한 이슈가 이걸 의미하는걸까 싶었고 또한 콘솔에 많은 에러가 찍혀있는건 개발자 입장에서도 매우 거슬렸기 때문에 이를 본격적으로 해결하고자 했어요.</p>\n<p><a href=\"https://vaihe.com/blog/react-hydration-error-explained/\" target=\"_blank\" rel=\"nofollow\">해당 블로그</a>에서 그 원인을 찾을 수 있었어요. 이 에러의 정확한 명칭은 <strong>React Hydration</strong> 에러이고, 이 에러는 Client Render와 Server Render가 일치하지 않을때 발생한다고 해요.</p>\n<p>Gatsby는 Pre-Render되는 속성이 있기 때문에, 이때 이 Pre-Render되는 HTML 파일과 React(대표적 CSR 라이브러리이자 Gatsby의 근간)에서 Virtual Dom으로 쌓아올린 HTML 파일과 <span style=\"color:red\">일치하지 않아서 발생하는 거예요.</span> 그래서 Pre-Render된 HTML 파일이 렌더링이 되는 것이 아니라 자체적으로  React가 쌓아올린걸로 replace 되버리는 거죠.</p>\n<p>이렇게 되버리면 우리는 Gatsby의 장점을 살릴 수 없어요 😱</p>\n<h3 id=\"해결\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0\" aria-label=\"해결 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결</h3>\n<p>결국엔 모든 문제는 Server와의 연산이 요구되는 코드에서 에러가 발생하는거라고 판단했어요. Pre-Render 시에는 Server 연산을 참조하지 못하는데요, 대표적으로 <code class=\"language-text\">window</code> 객체라는게 뭔지도 모르는 상태에서 요청하면 안되기 때문에 이를 Validation하는 작업이 필요해요.</p>\n<p>제 블로그에서 첫 index page를 load 할때 가장 의심이 가는 부분은 바로 다크모드를 handle할 수 있는 <code class=\"language-text\">HeaderTheme</code> 컴포넌트였어요. 왜냐하면 localStorage를 참조하여 dark인지 light인지를 담는 연산을 수행하고 있기 때문이에요.</p>\n<p>그래서 <code class=\"language-text\">HeaderTheme</code>의 토글 버튼이 로딩을 <strong>lazy loading</strong>으로 수행함으로써 이 문제를 해결할 수 있었어요.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// ClientOnly.tsx</span>\r\n<span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useState<span class=\"token punctuation\">,</span> useEffect<span class=\"token punctuation\">,</span> ReactNode<span class=\"token punctuation\">,</span> FunctionComponent <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\r\n\r\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">ClientProps</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n  children<span class=\"token operator\">:</span> ReactNode\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">const</span> ClientOnly<span class=\"token operator\">:</span> FunctionComponent<span class=\"token operator\">&lt;</span>ClientProps<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> children <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isMounted<span class=\"token punctuation\">,</span> setIsMounted<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">boolean</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\r\n\r\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">setIsMounted</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isMounted<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> ClientOnly</code></pre></div>\n<p><code class=\"language-text\">ClientOnly</code>를 <code class=\"language-text\">HeaderTheme</code> 컴포넌트의 최상단으로 배치해서 HTML 파일이 모두 성공적으로 load후 토글버튼을 리턴하는 방식으로 이 문제를 해결할 수 있었어요.</p>\n<p>이건 실제로 제가 해결한 <a href=\"https://github.com/dobyming/dobyming.github.io/pull/16#issue-1723164020\" target=\"_blank\" rel=\"nofollow\">PR</a> 이에요.</p>\n<h2 id=\"svg-icon-flicker-issue\" style=\"position:relative;\"><a href=\"#svg-icon-flicker-issue\" aria-label=\"svg icon flicker issue permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SVG Icon Flicker Issue</h2>\n<p><img src=\"https://velog.velcdn.com/images/damin1025/post/c555ab5e-d15c-482f-925e-ead9b3db00ab/image.gif\" alt=\"\"></p>\n<p>이건 GIF를 보면서 설명하면 더 이해가 잘될것 같아요.\r\n혹시 <code class=\"language-text\">&lt;-</code> 아이콘이 갑자기 Resizing이 일어나고 그리고 Dark mode Toggle 버튼은 해->달로 잠깐 깜빡이는것을 목격하셨나요?</p>\n<p>기능은 정상적으로 수행은 되는 버튼이라도, 이런 자잘한 에러들은 UX를 떨어트리는 요소라고 생각했어요.</p>\n<p>우선 <code class=\"language-text\">&lt;-</code> 버튼 같은 경우는 <code class=\"language-text\">fontAwesome</code>에서 icon을 import하여 사용하고 있었어요. 그리고 이 Resizing 에러가 발생한 원인은 다음과 같았어요.</p>\n<blockquote>\n<p>Instead, they are downloaded through a separate network request and then inserted into the document using Javascript. It’s essentially DOM manipulation, which is how React (which underlies Gatsby) works. Only this time, instead of manipulating UI elements like <code class=\"language-text\">&lt;div></code>, it is inserting a <code class=\"language-text\">&lt;style></code> element. Essentially, the styles are downloaded externally and inserted into the document through DOM manipulation. (<a href=\"https://medium.com/@fabianterh/fixing-flashing-huge-font-awesome-icons-on-a-gatsby-static-site-787e1cfb3a18\" target=\"_blank\" rel=\"nofollow\">출처</a>)</p>\n</blockquote>\n<p>요약하면, 해당 icon이 inline하게 HTML에 insert되는게 아니라 <code class=\"language-text\">style</code> 태그로 삽입되어서 <strong>외부적</strong>으로 download가 이뤄진 후에 DOM에 삽입이 되어서 이런 이슈가 발생하는거라고 해요. 즉 Gatsby에선 이 icon이 CSS가 load되어 삽입되기 전에 이미 존재하기 때문에 Resize되는 현상을 목도하게 되는거에요.</p>\n<p>따라서 이 문제는 icon이 CSS에 Auto Add 되는것을 막으면 해결할 수 있어요. 즉 <code class=\"language-text\">inline</code>하게 설계해야 하는거죠. FontAwesome의 Config setting을 통해 쉽게 해결할 수 있어요. 그러면 build time에 해당 icon이 내장하게 되요.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// gatsby-browser.js</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token string\">'@fortawesome/fontawesome-svg-core/styles.css'</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> config <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@fortawesome/fontawesome-svg-core'</span>\r\n\r\nconfig<span class=\"token punctuation\">.</span>autoAddCss <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br/>\n<h3 id=\"useeffect와-uselayouteffect-적절히-사용하기\" style=\"position:relative;\"><a href=\"#useeffect%EC%99%80-uselayouteffect-%EC%A0%81%EC%A0%88%ED%9E%88-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-label=\"useeffect와 uselayouteffect 적절히 사용하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>useEffect와 useLayoutEffect 적절히 사용하기</h3>\n<p>다음으론 다크모드 토글버튼의 상태값이 해->달로 잠깐 보였다가 사라지는 이슈를 해결할 차례예요. 우선 React Developer Tool로 State의 감지를 살펴봤을땐 boolean값이 잠깐 바뀌는 현상이 일어나진 않았어요.</p>\n<p>그럼 뭐가 문제인걸까 생각했을때, 이벤트가 Trigger되는 시점에 대해서 생각해보게 됐어요. 저는 다크모드 토글이 이뤄지는 이벤트 Trigger를 <code class=\"language-text\">useEffect</code> 리액트 훅을 이용하여 Trigger했었는데, 이에 대적하는 <code class=\"language-text\">useLayoutEffect</code> 리액트 훅에 대해서 알아보기로 했어요.</p>\n<p>사실 기업 면접에서 <code class=\"language-text\">useEffect</code> 와 <code class=\"language-text\">useLayoutEffect</code>의 차이점을 아세요? 라는 질문을 받았던 경험이 있었는데 슬프게도 대답을 못했고, 또한 사용해보지 않은 Hook 이었기 때문에 이참에 더 알아보기로 했어요. 이 <a href=\"https://pubudu2013101.medium.com/what-is-the-real-difference-between-react-useeffect-and-uselayouteffect-51723096dc19\" target=\"_blank\" rel=\"nofollow\">블로그</a>에서 많은 도움을 받았어요.</p>\n<p>두 리액트 훅의 결정적 차이는 바로 <strong>시점</strong>으로 볼 수 있어요.</p>\n<h4 id=\"useeffect\" style=\"position:relative;\"><a href=\"#useeffect\" aria-label=\"useeffect permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>useEffect</h4>\n<p>useEffect 는 컴포넌트들이 <strong>render 와 paint</strong> 된 후 실행돼요. 즉 비동기적(asynchronous) 으로 실행되고, paint된 후 실행되기 때문에 useEffect 내부에 DOM에 영향을 주는 코드가 있을 경우 사용자 입장에서는 화면의 flicker 현상을 볼 수 있어요.</p>\n<h4 id=\"uselayouteffect\" style=\"position:relative;\"><a href=\"#uselayouteffect\" aria-label=\"uselayouteffect permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>useLayoutEffect</h4>\n<p>useLayoutEffect 는 컴포넌트들이 <strong>render 된 후 실행되며</strong>, 그 이후에 paint 되요. 이 작업은 동기적(synchronous) 으로 실행되며 paint 가 되기전에 실행되기 때문에 DOM을 조작하는 코드가 존재하더라도 사용자는 깜빡임을 경험하지 않아요.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// trigger theme change refer localStorage's key-value</span>\r\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>userTheme <span class=\"token operator\">===</span> <span class=\"token string\">'dark'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token string\">'light'</span><span class=\"token punctuation\">)</span>\r\n      document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dark'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token function\">setIsDark</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n      document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dark'</span><span class=\"token punctuation\">)</span>\r\n      document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'light'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token function\">setIsDark</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>userTheme<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>기존 코드를  보면, <code class=\"language-text\">document</code> 객체에 접근하죠? 그리고 <code class=\"language-text\">useEffect</code>로 이를 Trigger하고 있기 때문에 현재 state가 flicker되는 현상을 볼 수 있었던거예요.</p>\n<p>이때 주의할 점은 <code class=\"language-text\">useLayoutEffect</code>는 paint되기 전에 실행되기 때문에 <strong>React Hydration Issue</strong> 를 만날 수 있는데 (클라이언트화면 !== 서버화면) 이는 상단에 제가 언급한 Minified error와 맞물리기 때문에 해당 validation을 최상단 컴포넌트에서 감아주면 문제를 해결할 수 있어요.</p>\n<h3 id=\"gatsby-plugin-offline-활용하기\" style=\"position:relative;\"><a href=\"#gatsby-plugin-offline-%ED%99%9C%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-label=\"gatsby plugin offline 활용하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>gatsby-plugin-offline 활용하기</h3>\n<p>그리고 추가적으로 <code class=\"language-text\">gatsby-plugin-offline</code> 설치를 하게 되면 깜빡임 현상을 더욱 최소화 할 수 있어요. <code class=\"language-text\">gatsby-plugin-offline</code>은 <strong>Service Worker</strong>를 활용해서 작동합니다. 그럼 서비스워커는 무엇일까요?</p>\n<blockquote>\n<p>서비스 워커는 웹 응용 프로그램, 브라우저, 그리고 (사용 가능한 경우) 네트워크 사이의 프록시 서버 역할을 합니다. 서비스 워커의 개발 의도는 여러가지가 있지만, 그 중에서도 효과적인 오프라인 경험을 생성하고, 네트워크 요청을 가로채서 네트워크 사용 가능 여부에 따라 적절한 행동을 취하고, 서버의 자산을 업데이트할 수 있습니다. 또한 푸시 알림과 백그라운드 동기화 API로의 접근도 제공합니다. (출처: <a href=\"https://developer.mozilla.org/ko/docs/Web/API/Service_Worker_API\" target=\"_blank\" rel=\"nofollow\">MDN</a>)</p>\n</blockquote>\n<p><img src=\"https://github.com/dobyming/dobyming.github.io/assets/90133704/9ab3f2eb-f665-4c5c-aeec-9f83ee2264da\" alt=\"gatsby-service-worker\"></p>\n<p>페이지를 최초 요청할때 static한 asset들(SVG Icon)을 내려 받고, CacheStorage에 저장을 합니다. 따라서 유저가 향후 웹사이트를 재방문할때 유저의 Cache Storage에 저장된 assets들을 참고하여, 빠르게 불러올 수 있습니다. 그렇기 때문에 깜빡임 현상을 최소화 할 수 있습니다.</p>\n<p>이때 config options를 통해서 어느 페이지 또는 어떤 폴더에 대해서만 Cache에 담을 지 부여할 수 있어요. 이 Option이 필요한 이유는 역시 사용자 경험과 밀접한 연관을 맺고 있어요. 만약 최초로 방문하는 유저일 경우에는 모든 리소스들을 Cache에 담는 작업이 수행된다면, 사용자별로 Cache 사이즈도 상이하고 그리고 Band-width도 상이하기 때문에 어떤 환경에서는 빠를지 몰라도, 또 다른 유저는 느리게 느껴질 수도 있어요.</p>\n<p>따라서 아래와 같이 내가 어떤 상황에서만 cache작업을 하겠다는 것을 부여할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\r\n    <span class=\"token literal-property property\">resolve</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-plugin-offline</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">precachePages</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/blog/*</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"결과물\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EA%B3%BC%EB%AC%BC\" aria-label=\"결과물 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결과물</h3>\n<p>위 과정들을 거치고 나면..!</p>\n<p><img src=\"https://velog.velcdn.com/images/damin1025/post/c03d5350-d60b-44e2-a565-04f092e6f3b2/image.gif\" alt=\"\"></p>\n<p>더이상은 해로 잠깐 보였다가 사라지는 현상은 볼 수 없게 되요😙</p>\n<h2 id=\"ongoing\" style=\"position:relative;\"><a href=\"#ongoing\" aria-label=\"ongoing permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ongoing..</h2>\n<p>Gatsby로 이것저것 접목해서 블로그를 만들면서 가장 많이 접한 개념은 브라우저의 작동방식이었어요. 실제로 개발을 진행하면서 CSR, SSR, SSG와 같이 렌더링에 대한 개념을 기존보다 더 딥하게 체감하며 개념의 중요성을 깨달을 수 있었던 좋은 트러블 슈팅을 경험했다고 생각해요.</p>\n<h3 id=\"-230529-lighthouse-점수-\" style=\"position:relative;\"><a href=\"#-230529-lighthouse-%EC%A0%90%EC%88%98-\" aria-label=\" 230529 lighthouse 점수  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>+) 23.05.29 LightHouse 점수 💯</h3>\n<p><img src=\"https://velog.velcdn.com/images/damin1025/post/89bfd0af-9bac-4670-b46e-c27acc9d1d00/image.PNG\" alt=\"\"></p>\n<p>Performance에서 2점이 부족한데.. 400점을 받는 그날까지 계속해서 성능 튜닝을 진행할 예정입니닷..!👊</p>\n<h3 id=\"️참고\" style=\"position:relative;\"><a href=\"#%EF%B8%8F%EC%B0%B8%EA%B3%A0\" aria-label=\"️참고 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🙇🏼‍♀️참고</h3>\n<p><strong>React Hydration Issue</strong></p>\n<p><a href=\"https://www.codeandweb.com/tutorials/gatsby-lazy-loading-with-react-lazy\" target=\"_blank\" rel=\"nofollow\">https://www.codeandweb.com/tutorials/gatsby-lazy-loading-with-react-lazy</a></p>\n<p><a href=\"https://egghead.io/lessons/react-avoiding-state-flickers-in-gatsby-applications\" target=\"_blank\" rel=\"nofollow\">https://egghead.io/lessons/react-avoiding-state-flickers-in-gatsby-applications</a></p>\n<p><a href=\"https://vaihe.com/blog/fixing-gatsby-hydration-flicker-issue/\" target=\"_blank\" rel=\"nofollow\">https://vaihe.com/blog/fixing-gatsby-hydration-flicker-issue/</a></p>\n<p><strong>Gastby SSR Issue(함께 읽으면 좋음)</strong></p>\n<p><a href=\"https://stackoverflow.com/questions/64371186/gatsby-window-not-available-during-server-side-rendering-build-error\" target=\"_blank\" rel=\"nofollow\">https://stackoverflow.com/questions/64371186/gatsby-window-not-available-during-server-side-rendering-build-error</a></p>\n<p><a href=\"https://www.gatsbyjs.com/docs/debugging-html-builds/#how-to-check-if-window-is-defined\" target=\"_blank\" rel=\"nofollow\">https://www.gatsbyjs.com/docs/debugging-html-builds/#how-to-check-if-window-is-defined</a></p>","headings":[{"depth":2,"value":"#418 #423 Minified Error"},{"depth":3,"value":"해결"},{"depth":2,"value":"SVG Icon Flicker Issue"},{"depth":3,"value":"useEffect와 useLayoutEffect 적절히 사용하기"},{"depth":4,"value":"useEffect"},{"depth":4,"value":"useLayoutEffect"},{"depth":3,"value":"gatsby-plugin-offline 활용하기"},{"depth":3,"value":"결과물"},{"depth":2,"value":"Ongoing.."},{"depth":3,"value":"+) 23.05.29 LightHouse 점수 💯"},{"depth":3,"value":"🙇🏼‍♀️참고"}],"frontmatter":{"title":"Gatsby 블로그 - 개발하면서 만났던 Issue","summary":"Gatsby로 블로그를 개발하면서 직면했던 Issue들과 Trouble Shooting 방법들을 공유합니다.","date":"2023.05.29.","categories":["Web","Gatsby"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAOABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAYBAgQJ/8QAFQEBAQAAAAAAAAAAAAAAAAAABQf/2gAMAwEAAhADEAAAAej7DG9adpRYbmP/xAAZEAEBAQEBAQAAAAAAAAAAAAAEAwUCFAD/2gAIAQEAAQUC6KeedLGFftEPPcWpEw2b9U/Jt6Ef/8QAIBEAAgIBBAMBAAAAAAAAAAAAAgMBBBEABQYSExQhI//aAAgBAwEBPwGhu3B08f21dikpu9qg4vGdIGA4JhEJEc0B/ZZewTmnbZDBkIH7GNWZWVmwSceInulXUeseOWFK8DiOsdcYHEYj5iNf/8QAIREAAgECBgMAAAAAAAAAAAAAAQIDEiEABRETFEEEMTL/2gAIAQIBAT8B4mZvmE55O14UlJiJeY7bgNWTTLIdtwIlSOKBaXqZvbMU1CIG+qVq7vpe/d8f/8QAJBAAAgICAQMEAwAAAAAAAAAAAQIDEQQSEwAhIgUGMTIUQVH/2gAIAQEABj8Cb1XM9RmxIFyBi8UOEMp3krYFfNW7rszDsFSIm7NFI4vcIeSQ0kYxF3Y0rdlLA/DAn9AHv1Nj78nDI0e9a76mtte9X/Onw58GPMieUyss2jRn6UGikikRtWQMCfg0R3HUPE+dgcbEt+Hk445gdfGXnwZ/Fde2mn2a78ann115pXk1u9djdXQuuv/EABsQAQEAAwEBAQAAAAAAAAAAAAERACExUYGR/9oACAEBAAE/IT0uUZZFDcI2WcUehAiTRD5ABQYjCT7K6gIfUKHuOOmBFuQys4gBzUmLH6nfKA2luH9RRq+ILC+Z/9oADAMBAAIAAwAAABDrP//EABcRAQEBAQAAAAAAAAAAAAAAAAERACH/2gAIAQMBAT8QK7JHonigt2WwQCRIZg6iyjySEP/EABgRAQEBAQEAAAAAAAAAAAAAAAERACEx/9oACAECAQE/EH17QydZwsFD6DaIKmpJdNdVrXtd/8QAFxABAQEBAAAAAAAAAAAAAAAAAREAIf/aAAgBAQABPxC2F8Vvpo8EfNcNO2XAbVIR5RXal3ZSbabWC1UvteHeLtQwV6IV9LPjfNtjzxzzlidLQBA3io3/2Q=="},"images":{"fallback":{"src":"/static/4db6d237b7d4d1f44584549913541e0c/cce54/error.jpg","srcSet":"/static/4db6d237b7d4d1f44584549913541e0c/51190/error.jpg 512w,\n/static/4db6d237b7d4d1f44584549913541e0c/d0278/error.jpg 1024w,\n/static/4db6d237b7d4d1f44584549913541e0c/cce54/error.jpg 2048w","sizes":"(min-width: 2048px) 2048px, 100vw"},"sources":[{"srcSet":"/static/4db6d237b7d4d1f44584549913541e0c/5223d/error.webp 512w,\n/static/4db6d237b7d4d1f44584549913541e0c/da5ae/error.webp 1024w,\n/static/4db6d237b7d4d1f44584549913541e0c/0b935/error.webp 2048w","type":"image/webp","sizes":"(min-width: 2048px) 2048px, 100vw"}]},"width":2048,"height":1457}},"publicURL":"/static/4db6d237b7d4d1f44584549913541e0c/error.jpg"}}}}]}},"pageContext":{"slug":"/posts/Gatsby-Trouble-Shooting/","prev":null,"next":{"node":{"fields":{"slug":"/posts/Gatsby-다크모드-구현기/"},"headings":[{"depth":2,"value":"동기"},{"depth":2,"value":"Theme을 어떻게 전달할 것인가 : ThemeProvider VS CSS Variable"},{"depth":3,"value":"🤔 emotion의 ThemeProvider로 삽질"},{"depth":3,"value":"🥰 CSS Variable로 광명을 찾다"},{"depth":2,"value":"Flicker Issue 에러 해결하기"},{"depth":2,"value":"🔮 Utterance에 다크모드 적용하기"},{"depth":3,"value":"결과물"},{"depth":2,"value":"마무리"},{"depth":3,"value":"🙇🏼‍♀️ 참고"}]}}}},"staticQueryHashes":["1463137677"],"slicesMap":{}}