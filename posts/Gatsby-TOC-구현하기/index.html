<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.8.1"/><meta data-react-helmet="true" name="description" content="포스팅을 읽다보면, 다시 읽고 싶은 부분으로 돌아가고 싶었던 경험이 있을겁니다. 이때 일일이 스크롤해서 내가 원하는 컨텐츠를 읽는것은 사용자 경험이 굉장히 떨어지는 행위입니다."/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1.0"/><meta data-react-helmet="true" http-equiv="Content-Type" content="text/html;charset=UTF-8"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:title" content="Gatsby 블로그 - TOC 기능 구현하기"/><meta data-react-helmet="true" property="og:description" content="포스팅을 읽다보면, 다시 읽고 싶은 부분으로 돌아가고 싶었던 경험이 있을겁니다. 이때 일일이 스크롤해서 내가 원하는 컨텐츠를 읽는것은 사용자 경험이 굉장히 떨어지는 행위입니다."/><meta data-react-helmet="true" property="og:image" content="/static/0e6a2859511bc04abeba878c5508a73f/gatsby.jpg"/><meta data-react-helmet="true" property="og:url"/><meta data-react-helmet="true" property="og:site_name" content="Gatsby 블로그 - TOC 기능 구현하기"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Gatsby 블로그 - TOC 기능 구현하기"/><meta data-react-helmet="true" name="twitter:description" content="포스팅을 읽다보면, 다시 읽고 싶은 부분으로 돌아가고 싶었던 경험이 있을겁니다. 이때 일일이 스크롤해서 내가 원하는 컨텐츠를 읽는것은 사용자 경험이 굉장히 떨어지는 행위입니다."/><meta data-react-helmet="true" name="twitter:image" content="/static/0e6a2859511bc04abeba878c5508a73f/gatsby.jpg"/><meta data-react-helmet="true" name="twitter:site" content="@사용자이름"/><meta data-react-helmet="true" name="twitter:creator" content="@사용자이름"/><meta data-react-helmet="true" name="google-site-verification" content="xE3auPHV6cacveeZD8Ln09qMfHXMDLn1HolWdbzhfk0"/><meta data-react-helmet="true" name="naver-site-verification" content="d4b0bb2e16cfc98a2826d2ffe989006d74cb2cbf"/><style data-href="/styles.cad6dbda6e465135f113.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}.light{--color-background:#f6f6f6;--color-category-bg:#000;--color-category-font:#fff;--color-postLink-shadow:0 0 8px rgba(0,0,0,.15)}.dark{--color-background:#25262c;--color-text:#f6f6f6;--color-category-bg:#e8e8e8;--color-category-font:#000;--color-postLink-shadow:0 0 5px #000}body{background-color:var(--color-background);transition:.2s}a,footer,h1,h2,h3,h4,h5,hr,li,p,span,td,tr{color:var(--color-text)}.LeftPrev path,.RightNext path,.ScrollToTop path{fill:var(--color-text)}div .categoryItems{background:var(--color-category-bg);color:var(--color-category-font)}div .postItemWrapper{box-shadow:var(--color-postLink-shadow)}</style><link rel="canonical" href="https://dobyming.github.io/posts/Gatsby-TOC-구현하기/" data-baseprotocol="https:" data-basehost="dobyming.github.io"/><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><title data-react-helmet="true">Gatsby 블로그 - TOC 기능 구현하기</title><link rel="icon" href="/favicon-32x32.png?v=a04f0cffc2ba7434f893e2b100af3e70" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a04f0cffc2ba7434f893e2b100af3e70"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a04f0cffc2ba7434f893e2b100af3e70"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a04f0cffc2ba7434f893e2b100af3e70"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a04f0cffc2ba7434f893e2b100af3e70"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a04f0cffc2ba7434f893e2b100af3e70"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a04f0cffc2ba7434f893e2b100af3e70"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a04f0cffc2ba7434f893e2b100af3e70"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a04f0cffc2ba7434f893e2b100af3e70"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css 13ku56z">.css-13ku56z{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:100%;}</style><main class="css-13ku56z e1strnqo0"><style data-emotion="css-global 16vf086">@import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR&display=swap');*{padding:0;margin:0;box-sizing:border-box;font-family:'IBM Plex Sans KR',sans-serif;}html,body,#___gatsby{height:100%;}a,a:hover{-webkit-text-decoration:none;text-decoration:none;cursor:pointer;}</style><style data-emotion="css 16cz9yp">.css-16cz9yp{position:relative;width:100%;height:400px;}@media (max-width: 768px){.css-16cz9yp{height:300px;}}</style><div class="css-16cz9yp e1opi4mu1"><style data-emotion="css 1bjn9yo">.css-1bjn9yo{z-index:-1;width:100%;height:400px;object-fit:cover;-webkit-filter:brightness(0.25);filter:brightness(0.25);}@media (max-width: 768px){.css-1bjn9yo{height:300px;}}</style><div data-gatsby-image-wrapper="" style="position:absolute" class="gatsby-image-wrapper gatsby-image-wrapper-constrained css-1bjn9yo e1opi4mu0"><div style="max-width:1500px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg%20height=&#x27;1000&#x27;%20width=&#x27;1500&#x27;%20xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%20version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAANABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAUEBgcJ/8QAFQEBAQAAAAAAAAAAAAAAAAAAAgT/2gAMAwEAAhADEAAAAevkXeWNDrY/Jx//xAAdEAACAgEFAAAAAAAAAAAAAAACBAEFBgADBxMX/9oACAEBAAEFAh5ATnKPUsR6aq3r7tSFFRZ0ABtx/8QAGxEAAgIDAQAAAAAAAAAAAAAAAQIREhBBUWH/2gAIAQMBAT8Bcoa0UpCgNLWltt5PMf/EAB0RAAICAgMBAAAAAAAAAAAAAAEDAhEEEgAUISL/2gAIAQIBAT8ByJ48yvrpkgRTCLBJhZu4Xu0EgaiXnwPBViroc//EACUQAAMBAAEDAgcBAAAAAAAAAAECAwQRBRITFCEABhAkMTI0Qv/aAAgBAQAGPwLT8tP0vqa+njsqOoiLUjU4J6aaESKIaNx6Swn4zWlGfL2y+4HZWj6di0zwve8Bg0aDNY28IX1eQaOmVOh/5XhurG36rXvIUjd0y50ZDSshUw0QBpFvHZQumUXPioGlQheFslJE+SdFV9i5s666IJ01CMxpeY44m9wvkZBwOFLFRwPb2+nbNFRe534RQo76OaUbgf6ejM7n8s7FjySfj//EABkQAQEBAQEBAAAAAAAAAAAAAAERACEQQf/aAAgBAQABPyEjLEp4QJKiIJgcahYFuOLisO8zbbmtGtSJvbXOKdedB8/cQjxSjIZ1SIMXanWf/9oADAMBAAIAAwAAABAgD//EABcRAQEBAQAAAAAAAAAAAAAAAAERIQD/2gAIAQMBAT8QfjBiI7JQjGMJSWHf/8QAGBEBAAMBAAAAAAAAAAAAAAAAARARITH/2gAIAQIBAT8QZ3Jzl6iWmkgMf//EABgQAQEAAwAAAAAAAAAAAAAAAAEAEDGB/9oACAEBAAE/EFOLxCvRNqYKNnjKSiOytuICJmn100DgI1PLXTpXSj4MZMA/AHvsNU2l/9k=" alt=""/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1500px) 1500px, 100vw" decoding="async" loading="lazy" data-src="/static/0e6a2859511bc04abeba878c5508a73f/f77da/gatsby.webp" data-srcset="/static/0e6a2859511bc04abeba878c5508a73f/dd2c8/gatsby.webp 375w,/static/0e6a2859511bc04abeba878c5508a73f/c5e11/gatsby.webp 750w,/static/0e6a2859511bc04abeba878c5508a73f/f77da/gatsby.webp 1500w" alt="thumbnail"/><noscript><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1500px) 1500px, 100vw" decoding="async" loading="lazy" src="/static/0e6a2859511bc04abeba878c5508a73f/f77da/gatsby.webp" srcSet="/static/0e6a2859511bc04abeba878c5508a73f/dd2c8/gatsby.webp 375w,/static/0e6a2859511bc04abeba878c5508a73f/c5e11/gatsby.webp 750w,/static/0e6a2859511bc04abeba878c5508a73f/f77da/gatsby.webp 1500w" alt="thumbnail"/></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div><style data-emotion="css m1156n">.css-m1156n{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:768px;height:100%;margin:0 auto;padding:60px 0;color:#ffffff;}@media (max-width: 768px){.css-m1156n{width:100%;padding:40px 20px;}}</style><div class="css-m1156n e1st1jau3"><style data-emotion="css gywgo7">.css-gywgo7{display:grid;place-items:center;width:40px;height:40px;border-radius:50%;background:#ffffff;color:#000000;font-size:22px;cursor:pointer;box-shadow:0 0 10px rgba(0, 0, 0, 0.3);}@media (max-width: 768px){.css-gywgo7{width:30px;height:30px;font-size:18px;}}</style><a class="css-gywgo7 e1st1jau2" href="/"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-left" class="svg-inline--fa fa-arrow-left " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"></path></svg></a><style data-emotion="css gn4qtp">.css-gn4qtp{display:-webkit-box;overflow:hidden;overflow-wrap:break-word;margin-top:auto;text-overflow:ellipsis;white-space:normal;-webkit-line-clamp:2;-webkit-box-orient:vertical;font-size:45px;font-weight:800;}@media (max-width: 768px){.css-gn4qtp{font-size:30px;}}</style><div class="css-gn4qtp e1st1jau1">Gatsby 블로그 - TOC 기능 구현하기</div><style data-emotion="css 3gcnt2">.css-3gcnt2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-top:10px;font-size:18px;font-weight:700;}@media (max-width: 768px){.css-3gcnt2{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;font-size:15px;font-weight:400;}}</style><div class="css-3gcnt2 e1st1jau0"><div>Web / Gatsby</div><div>2023.05.16.</div></div></div></div><div><style data-emotion="css 1tjlath">.css-1tjlath{width:100%;position:-webkit-sticky;position:sticky;margin-top:35px;font-size:0.9rem;top:100px;}.css-1tjlath .wrapper{position:absolute;left:72.5rem;}.css-1tjlath .wrapper .content{width:240px;margin:0 0 0 5rem;}.css-1tjlath .wrapper .content ol{list-style:none;list-style-position:inside;line-height:1.5rem;margin:0;padding:0;}.css-1tjlath .wrapper .content ol li{border-left:2px solid #9b8df0;-webkit-transition:opacity 0.3s ease;transition:opacity 0.3s ease;opacity:0.5;}.css-1tjlath .wrapper .content ol li:hover{opacity:1;}.css-1tjlath .wrapper .content ol a{-webkit-text-decoration:none;text-decoration:none;}.css-1tjlath .wrapper .content ol .active{opacity:1;font-weight:700;}@media (max-width: 1388px){.css-1tjlath .wrapper{display:none;}}</style><div class="css-1tjlath e1051zj90"><div class="wrapper"><div class="content"><ol><li style="padding-left:22px" class="active"><a data-idx="0" href="#-동기">💭 동기</a></li><li style="padding-left:22px" class=""><a data-idx="1" href="#결과">결과</a></li><li style="padding-left:22px" class=""><a data-idx="2" href="#header를-어떻게-갖고-올것인가">header를 어떻게 갖고 올것인가?</a></li><li style="padding-left:22px" class=""><a data-idx="3" href="#value를-어떻게-slug화-할것인가">Value를 어떻게 slug화 할것인가?</a></li><li style="padding-left:22px" class=""><a data-idx="4" href="#data-흐름은">Data 흐름은?</a></li><li style="padding-left:22px" class=""><a data-idx="5" href="#toc-컴포넌트-styling">TOC 컴포넌트 Styling</a></li><li style="padding-left:22px" class=""><a data-idx="6" href="#scroll시-각-header에-맞게-active-기능-부여하기">Scroll시 각 header에 맞게 Active 기능 부여하기</a></li><li style="padding-left:22px" class=""><a data-idx="7" href="#header에-맞는-href로-이동하기">header에 맞는 href로 이동하기</a></li><li style="padding-left:33px" class=""><a data-idx="8" href="#-issue-handle">🪓 Issue Handle</a></li><li style="padding-left:22px" class=""><a data-idx="9" href="#-후기">🔮 후기</a></li></ol></div></div></div><style data-emotion="css 1u5fyl4">.css-1u5fyl4{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:768px;margin:0 auto;padding:80px 0;word-break:break-all;line-height:2;font-size:15px;font-weight:400;}.css-1u5fyl4 p{padding:3px 0;}.css-1u5fyl4 h1,.css-1u5fyl4 h2,.css-1u5fyl4 h3{font-weight:800;margin-bottom:20px;}.css-1u5fyl4 *+h1,.css-1u5fyl4 *+h2,.css-1u5fyl4 *+h3,.css-1u5fyl4 *+h4{margin-top:50px;}.css-1u5fyl4 hr+h1,.css-1u5fyl4 hr+h2,.css-1u5fyl4 hr+h3{margin-top:0;}.css-1u5fyl4 h1{font-size:30px;}.css-1u5fyl4 h2{font-size:25px;}.css-1u5fyl4 h3{font-size:20px;}.css-1u5fyl4 blockquote{margin:30px 0;padding:0 1em;color:#000000;border-left:0.25em solid #dfe2e5;}.css-1u5fyl4 ol,.css-1u5fyl4 ul{margin-left:20px;padding:30px 0;}.css-1u5fyl4 img{max-width:100%;box-shadow:0 0 5px rgba(0, 0, 0, 0.1);}.css-1u5fyl4 hr{border:0.5px solid #dfe2e5;margin:32px 0;}.css-1u5fyl4 a{color:#00a170;-webkit-text-decoration:none;text-decoration:none;}.css-1u5fyl4 a:hover{color:#f6546a;-webkit-text-decoration:underline;text-decoration:underline;}.css-1u5fyl4 pre[class*='language-']{padding:1em;margin:0.5em 0;overflow:auto;background:#1e1e1e;}.css-1u5fyl4 pre[class*='language-']::-webkit-scrollbar-thumb{background:rgba(255, 255, 255, 0.5);border-radius:3px;}.css-1u5fyl4 code[class*='language-'],.css-1u5fyl4 pre[class*='language-']{tab-size:2;}.css-1u5fyl4 code[class='language-text']{padding:0.1em 0.3em;border-radius:0.3em;white-space:normal;text-shadow:none;background:#b3d4fc;color:#000000;}@media (max-width: 768px){.css-1u5fyl4{width:100%;padding:10px 20px;line-height:1.6;font-size:14px;}.css-1u5fyl4 h1{font-size:23px;}.css-1u5fyl4 h2{font-size:20px;}.css-1u5fyl4 h3{font-size:17px;}.css-1u5fyl4 img{width:100%;}.css-1u5fyl4 hr{margin:50px 0;}}</style><div class="css-1u5fyl4 e1ijh0y10"><p>🤠 글이 꽤 깁니다!</p>
<h2 id="-동기" style="position:relative;"><a href="#-%EB%8F%99%EA%B8%B0" aria-label=" 동기 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>💭 동기</h2>
<p>포스팅을 읽다 보면, 다시 읽고 싶은 부분으로 돌아가고 싶었던 경험이 있을 겁니다. 이때 일일이 스크롤 해서 내가 원하는 콘텐츠를 읽는 것은 사용자 경험이 굉장히 떨어지는 행위입니다.</p>
<p>따라서 많은 개발 블로그에는 <strong>TOC</strong>, 즉 Table Of Contents를 제공합니다. 저 역시 제 블로그에 방문해 주시는 유저분들께 편리함을 제공하고자 TOC 기능을 제작하고 구현에 진행했습니다.</p>
<p>Velog나 다른 개발 블로그들에서 봤을 땐 복잡할 거라고 생각은 안 했는데, 역시 만만한 건 아무것도 없었습니다😅</p>
<h2 id="결과" style="position:relative;"><a href="#%EA%B2%B0%EA%B3%BC" aria-label="결과 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>결과</h2>
<p>먼저 구현 결과부터 보여드리겠습니다.</p>
<p>스크롤 시, 일정 위치에 heading이 scope 시 오른쪽에 있는 TOC의 각각의 요소들에 active 값이 활성화됨을 볼 수 있습니다.
<img src="https://velog.velcdn.com/images/damin1025/post/021cd97b-05b8-470c-8d95-1c82fe32e9e7/image.gif" alt=""></p>
<p>그리고 각 콘텐츠를 클릭 시, 알맞는 heading으로 direct 하게 이동합니다.
<img src="https://velog.velcdn.com/images/damin1025/post/ed65ab46-8384-4b63-8db1-f060334ae8a5/image.gif" alt=""></p>
<p>그럼 제가 어떤 flow로 TOC 기능을 개발했는지 회고하고자 합니다.</p>
<h2 id="header를-어떻게-갖고-올것인가" style="position:relative;"><a href="#header%EB%A5%BC-%EC%96%B4%EB%96%BB%EA%B2%8C-%EA%B0%96%EA%B3%A0-%EC%98%AC%EA%B2%83%EC%9D%B8%EA%B0%80" aria-label="header를 어떻게 갖고 올것인가 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>header를 어떻게 갖고 올것인가?</h2>
<p>우선 TOC 기능을 구현하는 데 있어, 가장 중요한 것은 포스팅에 있는 header를 어떻게 갖고 올 것인가입니다. 당연하게도 <code class="language-text">gatsby-node.js</code>에서 GraphQL로 요청해야 하는데, 이때 어떤 필드를 참조할 것인가를 생각해 봐야 합니다.</p>
<ol>
<li><code class="language-text">tableOfContents</code> 필드를 활용하기</li>
</ol>
<p><code class="language-text">tableOfContents</code> 필드를 GraphQL로 요청하여 <code class="language-text">dangerouslySetInnerHTML</code>에 __html 요소로 Props를 보내서 렌더링 하는 방법이 있습니다.
<img src="https://velog.velcdn.com/images/damin1025/post/dde204d0-a5ed-41f9-808e-dc0ab46cfef6/image.PNG" alt=""></p>
<ol start="2">
<li><code class="language-text">headings</code> 필드의 depth와 value를 활용하기</li>
</ol>
<p><img src="https://velog.velcdn.com/images/damin1025/post/eacbf940-6312-4203-8750-93f29f440712/image.PNG" alt=""></p>
<p>여기서 depth는 h1, h2,…에서 숫자에 해당하는 부분이고, value는 제목입니다. 저는 직접 depth를 handle 하여 CSS도 Styling 할 것이고, 그리고 배열을 돌면서 value를 TOC 컴포넌트에 렌더링 하고 싶었기 때문에 1번보단 2번 방법을 택했습니다.</p>
<h2 id="value를-어떻게-slug화-할것인가" style="position:relative;"><a href="#value%EB%A5%BC-%EC%96%B4%EB%96%BB%EA%B2%8C-slug%ED%99%94-%ED%95%A0%EA%B2%83%EC%9D%B8%EA%B0%80" aria-label="value를 어떻게 slug화 할것인가 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Value를 어떻게 slug화 할것인가?</h2>
<p>보통 <code class="language-text">tableOfContents</code> 필드를 활용해서 구현한다면 slug를 자체적으로 알아서 만들어서 <code class="language-text">href</code>로 접근할 수 있도록 값이 부여되는데, 저같은 경우는 <code class="language-text">headings</code>를 활용하기 때문에 <strong>제목을 어떻게 slug 화할 것인가</strong>를 고민해 봤어야 했습니다.</p>
<p>정말 npm은 없는게 없군요.. <a href="https://www.npmjs.com/package/github-slugger" target="_blank" rel="nofollow">github-slugger</a> 라는 패키지를 통해서 slug에 대한 고민을 해결할 수 있었습니다. 해당 패키지를 npm으로 설치하고, <code class="language-text">slug(value)</code> 메서드만 선언하면 알아서 value(제목)를 slug화 해주는 아주 친절한 패키지를 활용하여 해당 고민을 해결할 수 있었습니다.</p>
<h2 id="data-흐름은" style="position:relative;"><a href="#data-%ED%9D%90%EB%A6%84%EC%9D%80" aria-label="data 흐름은 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Data 흐름은?</h2>
<p><img src="https://velog.velcdn.com/images/damin1025/post/6f0fe709-8358-4507-aba0-ca1bc62cb64a/image.PNG" alt=""></p>
<p>데이터 흐름은 위와 같이 <code class="language-text">post_template.tsx</code> (포스팅 템플릿)에서 GraphQL로 요청한 headings(depth,value)를 <code class="language-text">PostTOC.tsx</code> 에 전달하는 구조로 설계하고 구현에 진행했습니다.</p>
<h2 id="toc-컴포넌트-styling" style="position:relative;"><a href="#toc-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-styling" aria-label="toc 컴포넌트 styling permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>TOC 컴포넌트 Styling</h2>
<p>자 그럼 GraphQL로 요청한 headings들을 이쁘게 Render하기 위해  Styling 작업을 해야 합니다.</p>
<p>사실 TOC 기능을 만들면서 꽤 시간을 많이 들였던 부분이 바로 이 Styling 부분이기도 했습니다. CSS적으로 deep하게 MockUp 했고.. 따라서 이건 본인이 스스로 고민하면서 만드는 것을 추천드립니다. 제 코드를 봐도 본인 프로젝트에서는 또 적용이 안될수도 있기 때문입니다 ㅠ</p>
<p>이건 제가 Scheme한 부분입니다.
<img src="https://velog.velcdn.com/images/damin1025/post/dd2ad444-f17c-4215-9d85-52ff52623c6d/image.jpg" alt="">
이런식으로 본인이 스스로 한번 구상하시는 것을 추천드립니다 🐣 그리고 포스팅을 읽을때, TOC 컴포넌트가 <strong>일정 위치에 고정</strong>되도록 구현하고 싶었기 때문에 <code class="language-text">Sticky</code> 속성을 부여했습니다.</p>
<p>또한 다크모드로 전환 시, 콘텐츠들의 글자색들이 바뀌어야 하기 때문에 body의 classList가 ‘dark’면 바뀔 수 있도록 값을 부여했습니다.</p>
<div class="gatsby-highlight" data-language="css"><pre class="language-css"><code class="language-css"><span class="token selector">a</span> <span class="token punctuation">{</span>
	<span class="token selector">color: $</span><span class="token punctuation">{</span>
    <span class="token function">isBrowser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> &amp;&amp; window.document.body.classList.<span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'dark'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h2 id="scroll시-각-header에-맞게-active-기능-부여하기" style="position:relative;"><a href="#scroll%EC%8B%9C-%EA%B0%81-header%EC%97%90-%EB%A7%9E%EA%B2%8C-active-%EA%B8%B0%EB%8A%A5-%EB%B6%80%EC%97%AC%ED%95%98%EA%B8%B0" aria-label="scroll시 각 header에 맞게 active 기능 부여하기 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scroll시 각 header에 맞게 Active 기능 부여하기</h2>
<p>Scroll시 각 Header에 맞게 Active하는 기능을 어떻게 구현해야 하는지를 고민해봤을때, 저는 Scroll값과 offsetTop값을 활용하여 처리하는 것으로 구상했습니다.</p>
<p><code class="language-text">InterSectionObserver</code> API를 활용하는 것이 물론 퍼포먼스적으로 좋다는 지표도 있지만, 우선 아직 저의 무지함으로 인해.. 구상부터 잘 이루어지지 않았습니다🙁.. Learning Curve가 있기에 좀 더 익숙해지면 해당 방법으로 마이그레이션을 고려할 수 있을것 같습니다.</p>
<p>따라서 제가 생각한 방법은 Scroll값에 따라 headings 배열을 돌면서 일정 offsetTop 값에 도달하면 Index 값을 참조하여 active 할 수 있는 방법은 어떨까? 로 구상했고 이 방법으로 구현에 진행할 수 있었습니다.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// PostTOC.tsx</span>
<span class="token keyword">const</span> calcActive <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isBrowser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> offsets<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token comment">// bring each headings offsetTop</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">{</span> slug <span class="token punctuation">}</span> <span class="token keyword">of</span> headers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>slug<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      offsets<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>offsetTop <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> maxIndex <span class="token operator">=</span> offsets<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> scrollY <span class="token punctuation">}</span> <span class="token operator">=</span> window
    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token comment">// Scroll Active Trigger (looping the offset)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>scrollY <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">||</span> scrollY <span class="token operator">&lt;=</span> offsets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      index <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
      window<span class="token punctuation">.</span>innerHeight <span class="token operator">+</span> scrollY <span class="token operator">>=</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollHeight <span class="token operator">||</span>
      scrollY <span class="token operator">>=</span> offsets<span class="token punctuation">[</span>maxIndex<span class="token punctuation">]</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      index <span class="token operator">=</span> maxIndex
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      index <span class="token operator">=</span> <span class="token function">findIndex</span><span class="token punctuation">(</span>offsets<span class="token punctuation">,</span> offset <span class="token operator">=></span> offset <span class="token operator">>=</span> scrollY<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> index
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>headers<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div>
<p><code class="language-text">headers</code> 배열을 참조하여 value를 slug화 한 각각의 태그를 <code class="language-text">element</code>로 불러오고, 각각의 offsetTop 값을 <code class="language-text">offsets</code> 배열에 담습니다. 다시 말하면 <code class="language-text">offsets</code> 배열은 document 기준의 각 header들의 위치를 의미합니다.</p>
<p>그리고 스크롤 할때마다 Y축의 값을 반환하는 <code class="language-text">scrollY</code> 를 통해서, 3가지 상황으로 조건문을 분기할 수 있습니다. (사실 글보단 코드가 더 이해가 잘 될것 같긴 합니다😅)</p>
<ol>
<li>
<p>만약 <code class="language-text">scrollY</code> 값이 0(맨위) 또는 <code class="language-text">offsets[0]</code>(가장 첫번째 header 문구) 보다 작거나(닿기직전) 해당 위치에 도달 했다면? : <strong>index = 0으로 부여</strong></p>
</li>
<li>
<p><code class="language-text">scrollY</code> 값이 <code class="language-text">offset[maxIndex]</code>보다 크거나 같을때(마지막 header문구 위치와 같거나 지나쳤을때) 또는 window의 innerHeight와 <code class="language-text">scrollY</code> 를 합친 값이 document 기준의 scrollHeight보다 크거나 같을때(마지막 header문구를 지나친건 아니지만, ScrollHeight(스크롤하지 않았을때 전체 높이)를 넘겼을때) : <strong>index = maxIndex로 부여</strong></p>
</li>
<li>
<p>1,2에 해당하지 않을때</p>
</li>
</ol>
<p>그래서 이 <code class="language-text">index</code>를 활용해서 event를 trigger합니다.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// PostTOC.tsx</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>currentIndex<span class="token punctuation">,</span> setCurrentIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setCurrentIndex</span><span class="token punctuation">(</span><span class="token function">calcActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> onScrollForActive <span class="token operator">=</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCurrentIndex</span><span class="token punctuation">(</span><span class="token function">calcActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> onScrollForActive<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      onScrollForActive<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> onScrollForActive<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>calcActive<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div>
<p><code class="language-text">useEffect()</code> Hook을 활용하여 <code class="language-text">calcActive</code>에 따라 event가 Trigger될 수 있도록 dependency Array에 할당합니다.</p>
<p>이때 Scroll시, 매번 offsetTop 값과 ScrollY값을 연산해야 하기 때문에 싱글 스레드에 조금이라도 최적화 하는 작업이 필요합니다. 왜냐하면 Scroll시, 매번 연산하기 때문에 console을 찍어보면 값들이 무수히 찍히기 때문입니다.</p>
<p>따라서 저는 <a href="https://www.npmjs.com/package/@types/lodash-es" target="_blank" rel="nofollow">lodash-es</a>에서 제공하는 <code class="language-text">throttle()</code> 메소드를 활용하여 Scroll Event를 최적화 했습니다. 이는 Scroll시 매번 요청되는 call을 <code class="language-text">SetTimeOut()</code> 연산과 같은 구조로, 300ms를 기다렸다가 <code class="language-text">onScrollForActive</code>를 요청합니다.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// PostTOC.tsx</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ol</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token punctuation">{</span>headers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> value<span class="token punctuation">,</span> depth <span class="token punctuation">}</span><span class="token punctuation">,</span> idx<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span>
    <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>idx<span class="token punctuation">}</span></span>
    <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> paddingLeft<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>depth <span class="token operator">*</span> <span class="token number">11</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
    <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>currentIndex <span class="token operator">===</span> idx <span class="token operator">?</span> <span class="token string">'active'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span></span>
    <span class="token punctuation">></span></span><span class="token plain-text">
		// ...
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ol</span><span class="token punctuation">></span></span></code></pre></div>
<p><code class="language-text">calcActive()</code> 함수의 리턴 index가 <code class="language-text">useState</code> Hook의 현재 state로 담기는 <code class="language-text">currentIndex</code>에 담기면서, 실제 ol 태그내에서 headers 배열(<code class="language-text">PostTOC</code> 컴포넌트 상단에서 <code class="language-text">useMemo()</code>를 통해 연산한 값을 재사용 했습니다.) 을 도는 idx 값과 비교하게 되면서 <code class="language-text">currentIndex</code>와 일치하는 idx에 대해서만 active 활성화를 부여하게 되면, Scroll시 bold체로 활성화 되는 것을 볼 수 있습니다.</p>
<p>(*<code class="language-text">li</code>태그 에서 style은 indentation을 주기 위해서 depth를 활용한 것입니다.)</p>
<h2 id="header에-맞는-href로-이동하기" style="position:relative;"><a href="#header%EC%97%90-%EB%A7%9E%EB%8A%94-href%EB%A1%9C-%EC%9D%B4%EB%8F%99%ED%95%98%EA%B8%B0" aria-label="header에 맞는 href로 이동하기 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>header에 맞는 href로 이동하기</h2>
<p>그리고 <code class="language-text">a</code> 태그에 href 값으로 <code class="language-text">slug(value)</code>를 할당하게 되면 헤더에 맞는 위치로 이동하게 됩니다.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// PostTOC.tsx</span>
<span class="token comment">//...</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">data-idx</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>idx<span class="token punctuation">}</span></span> <span class="token attr-name">href</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">slug</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
	</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
<span class="token comment">//...</span></code></pre></div>
<h3 id="-issue-handle" style="position:relative;"><a href="#-issue-handle" aria-label=" issue handle permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>🪓 Issue Handle</h3>
<p><img src="https://github.com/dobyming/dobyming.github.io/assets/90133704/d9c2b8db-6934-4e50-9e93-bc0d5eb196f3" alt="2023-05-16 11;09;11"></p>
<p>Testing을 하던 중, console에 이런 error log가 찍혔습니다. 공통점을 보니, 숫자로 시작하는 헤더를 <code class="language-text">querySelector</code>가 parsing을 수행할 수 없다는 류의 에러였습니다. (TOC 컨테이너에 해당하는 헤더값을 클릭 시, 해당하는 헤더로 이동하지도 않았습니다.)</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> heading <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">querySelector</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLHeadingElement<span class="token operator">></span></span></span><span class="token punctuation">(</span>href<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>heading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>

window<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	top<span class="token operator">:</span> heading<span class="token punctuation">.</span>offsetTop<span class="token punctuation">,</span>
  behavior<span class="token operator">:</span> <span class="token string">'smooth'</span><span class="token punctuation">,</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>문제가 발생한 코드였고 <a href="https://stackoverflow.com/questions/37270787/uncaught-syntaxerror-failed-to-execute-queryselector-on-document" target="_blank" rel="nofollow">StackOverflow</a>에서 보니, <code class="language-text">querySelctor</code>는 숫자로 시작하는 heading은 인식하지 못한다는 것이었습니다. 따라서 위의 코드는 과감히 제거하고, <code class="language-text">a</code> 태그의 <code class="language-text">href</code>에 slug화 한 value를 할당하여 숫자로 시작하는 slug도 인식할 수 있도록 트러블 슈팅을 진행했습니다.</p>
<h2 id="-후기" style="position:relative;"><a href="#-%ED%9B%84%EA%B8%B0" aria-label=" 후기 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>🔮 후기</h2>
<p>일주일 가까이? 시간을 쏟고 나름 고생하면서 만들었네요.. 기능 개발에서 많은 고민과 시간을 투자해서 그런지 더 소중하게 다가옵니다. 의외로 CSS 스타일링도 내가 아는게 다 아니었구나를 또 깨달으며 역시 계속 배워야 한다는 것을 깨달았던 feature 개발이었습니다.</p>
<p>성능상 최적화해야 할 부분이 남은 숙제겠네요! 그래도 스스로 TOC 기능을 만든건 꽤나 뿌듯합니다.😊</p></div></div><style data-emotion="css l9zn25">.css-l9zn25{height:56px;margin-bottom:30px;}.css-l9zn25 ul{text-align:center;}.css-l9zn25 li{display:inline-block;*display:block;*zoom:1;height:56px;line-height:56px;white-space:nowrap;margin:0 10px;}.css-l9zn25 svg{margin-top:-3px;width:21px;height:21px;vertical-align:middle;}.css-l9zn25 a{-webkit-text-decoration:none;text-decoration:none;}.css-l9zn25 a:hover{-webkit-text-decoration:underline;text-decoration:underline;}.css-l9zn25 span{cursor:not-allowed;color:#888;}</style><nav class="css-l9zn25 e1t5r2y70"><ul><li><span><svg fill="gray" width="30px" height="30px" viewBox="0 0 24 24"><path fill="current" fill-rule="evenodd" clip-rule="evenodd" d="M15.7071 4.29289C16.0976 4.68342 16.0976 5.31658 15.7071 5.70711L9.41421 12L15.7071 18.2929C16.0976 18.6834 16.0976 19.3166 15.7071 19.7071C15.3166 20.0976 14.6834 20.0976 14.2929 19.7071L7.29289 12.7071C7.10536 12.5196 7 12.2652 7 12C7 11.7348 7.10536 11.4804 7.29289 11.2929L14.2929 4.29289C14.6834 3.90237 15.3166 3.90237 15.7071 4.29289Z"></path></svg> 다음글</span></li><li><a href="/posts/Gastby-이전글-다음글-구현/">이전글<svg class="RightNext" width="30px" height="30px" viewBox="0 0 24 24" fill="current"><path fill="current" fill-rule="evenodd" clip-rule="evenodd" d="M8.29289 4.29289C8.68342 3.90237 9.31658 3.90237 9.70711 4.29289L16.7071 11.2929C17.0976 11.6834 17.0976 12.3166 16.7071 12.7071L9.70711 19.7071C9.31658 20.0976 8.68342 20.0976 8.29289 19.7071C7.90237 19.3166 7.90237 18.6834 8.29289 18.2929L14.5858 12L8.29289 5.70711C7.90237 5.31658 7.90237 4.68342 8.29289 4.29289Z"></path></svg></a></li></ul></nav><style data-emotion="css hx9xpc">@media (max-width: 768px){.css-hx9xpc{padding:0 20px;}}</style><div class="css-hx9xpc e1gqsjds0"></div><style data-emotion="css 9w9jmx">.css-9w9jmx{display:grid;place-items:center;margin-top:auto;padding:50px 0;font-size:15px;text-align:center;line-height:1.5;}@media (max-width: 768px){.css-9w9jmx{font-size:13px;}}</style><footer class="css-9w9jmx e1oae0v80">© <!-- -->2023<!-- --> Damin-Kim, Powered By Gatsby.</footer></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/Gatsby-TOC-구현하기/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-5d9e8b4afb757c57a4b5.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-2073c6e4755e6d0bfb15.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-9a82b3a5efa60fb8e277.js\"],\"component---src-pages-info-tsx\":[\"/component---src-pages-info-tsx-1f7231da34a5e78aa38a.js\"],\"component---src-templates-post-template-tsx\":[\"/component---src-templates-post-template-tsx-1b084ab59fc18dbe5e64.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="d90696c6da849f6dd1b6";</script><script src="/webpack-runtime-7ea2fb2eddbc37847e99.js" async></script><script src="/framework-a4e155cd0476dc1ca208.js" async></script><script src="/app-5d9e8b4afb757c57a4b5.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>